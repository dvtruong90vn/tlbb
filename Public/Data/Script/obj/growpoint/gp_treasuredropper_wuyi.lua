--Éú³¤ ği¬m
--¶ÔÓ¦Éú»î¼¼ÄÜ: -1
--Võ Di±¦ÎïµôÂäÆ÷
--½Å±¾ºÅ******(712514)

--mµt cái±¦ÏäÀïº¬ÓĞ¼¸cáiÎïÆ·
x712514_g_DropNumTable  = {
	{num = 1, odd = 0.2},	--1cáitoÕ ğµ ¼¸ÂÊ
	{num = 2, odd = 0.4},	--2cáitoÕ ğµ ¼¸ÂÊ
	{num = 3, odd = 0.2},	--3cáitoÕ ğµ ¼¸ÂÊ
	{num = 4, odd = 0.15},	--4cáitoÕ ğµ ¼¸ÂÊ
	{num = 5, odd = 0.05},	--5cáitoÕ ğµ ¼¸ÂÊ
}

x712514_g_TickCreate_Msg = ""

--Ã¿ÖÖÎïÆ·ĞúngÄÄÀàÎïÆ·,ÇÒ´ËÀàÎïÆ·¶ÑµşÊıÁ¿Ğúng¼¸cái
x712514_g_DropTable = {
	--ÑªÒ©Àà
	{
		itemType = 1, 	--ÑªÒ©ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.293, 			--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 0.2},				--1cáitoÕ ğµ ¼¸ÂÊ
							{num = 2, odd = 0.4},				--2cáitoÕ ğµ ¼¸ÂÊ
							{num = 3, odd = 0.2},				--3cáitoÕ ğµ ¼¸ÂÊ
							{num = 4, odd = 0.15},			--4cáitoÕ ğµ ¼¸ÂÊ
							{num = 5, odd = 0.05},			--5cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						30001004,30003006,30101036,
					},
	},
	--À¶Ò©Àà
	{
		itemType = 2, 	--À¶Ò©ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.294, 			--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 0.2},				--1cáitoÕ ğµ ¼¸ÂÊ
							{num = 2, odd = 0.4},				--2cáitoÕ ğµ ¼¸ÂÊ
							{num = 3, odd = 0.2},				--3cáitoÕ ğµ ¼¸ÂÊ
							{num = 4, odd = 0.15},			--4cáitoÕ ğµ ¼¸ÂÊ
							{num = 5, odd = 0.05},			--5cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						30002004,30101046,
					},
	},
	--¿ÚÁ¸
	{
		itemType = 3, 	--¿ÚÁ¸toÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.2, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 0.2},				--1cáitoÕ ğµ ¼¸ÂÊ
							{num = 2, odd = 0.4},				--2cáitoÕ ğµ ¼¸ÂÊ
							{num = 3, odd = 0.2},				--3cáitoÕ ğµ ¼¸ÂÊ
							{num = 4, odd = 0.15},			--4cáitoÕ ğµ ¼¸ÂÊ
							{num = 5, odd = 0.05},			--5cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						30602006,30603006,30604006,30605006,
					},
	},
	--²ÄÁÏÀà
	{
		itemType = 4, 	--²ÄÁÏÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.1, 			--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 2, odd = 0.2},				--2cáitoÕ ğµ ¼¸ÂÊ
							{num = 4, odd = 0.4},				--4cáitoÕ ğµ ¼¸ÂÊ
							{num = 6, odd = 0.2},				--6cáitoÕ ğµ ¼¸ÂÊ
							{num = 8, odd = 0.15},			--8cáitoÕ ğµ ¼¸ÂÊ
							{num = 10, odd = 0.05},			--10cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						20101014,20101015,20101016,20102006,20102018,20103006,20104006,20105006,
					},
	},
	--°éÉúÀà
	{
		itemType = 12, 	--°éÉúÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.02, 			--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 0.3},				--1cáitoÕ ğµ ¼¸ÂÊ
							{num = 2, odd = 0.4},				--2cáitoÕ ğµ ¼¸ÂÊ
							{num = 3, odd = 0.3},				--3cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						20102030,20103018,20103030,20103042,20103054,20105018,
					},
	},
	--°×É«ÎäÆ÷Àà
	{
		itemType = 5, 	--°×É«ÎäÆ÷ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.045, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						10100006,10101006,10102006,10103006,10104006,10105006,
					},
	},
	--À¶É«ÎäÆ÷Àà
	{
		itemType = 10, 	--À¶É«ÎäÆ÷ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						 10200006,10201006,10202006,10203006,10204006,10205006,
					},
	},
	--°×É«×°±¸Àà
	{
		itemType = 6, 	--°×É«×°±¸ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.045, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						10110015,10110016,10110017,10111015,10111016,10111017,10112015,10112016,10112017,10113015,10113016,10113017,10120006,10121006,10122006,
					},
	},
	--À¶É«×°±¸Àà
	{
		itemType = 11, 	--À¶É«×°±¸ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						 10210011,10211011,10212011,10213011,10220006,10221006,10222006,
					},
	},
	--±¦Ê¯Àà
	{
		itemType = 7, 	--±¦Ê¯ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.001, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						50101001,50101002,50102001,50102002,50102003,50102004,50103001,50104002,50111001,50111002,50112001,50112002,50112003,50112004,50113001,50113002,50113003,50113004,50113005,50114001,
					},
	},
	--Åä·½Àà
	{
		itemType = 8, 	--Åä·½ÀàtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = 0.002, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 1.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÎïÆ·ĞòÁĞºÅ±í
						30304063,30304064,30304065,30304066,30304071,30304072,30304073,30304074,30304075,30304076,30304077,30304078,30304079,
					},
	},
	--ÕäÊŞ
	{
		itemType = 9, 	--ÕäÊŞtoÕ ğµ ÀàĞÍ±êÊ¶
	 	odd = -1.0, 		--³öÏÖ¼¸ÂÊ
	 	numOdd = {
							{num = 1, odd = 0.0},				--1cáitoÕ ğµ ¼¸ÂÊ
						 },
		idx = {	--ÕäÊŞĞòÁĞºÅ±í
						3009,3019,3029,
					},
	},
}

--±¦Îï»ØÊÕÊ±¼ä2006-8-21 17:33 ĞŞ¸ÄÎªÓÉ¹ÜÀíÆ÷´«µİ½øÀ´

--¸ù¾İ±¾´ÎËæ»úÊıÀ´ÕÒµ½±íÖĞ¶ÔÓ¦toÕ ğµ Ë÷Òı
function x712514_GetTableIndexByOdd(tb)
	local oddNow = random();
	
	local base = 0.0;
	for i = 1, getn(tb) do
		if(tb[i].odd + base >= oddNow) then
			return i;
		end
		base = base + tb[i].odd;
	end
	
	return nil;
end

--Éú³Éº¯Êı¿ªÊ¼************************************************************************
--Ã¿cáiItemBoxÖĞ×î¶à10cáiÎïÆ·,Tr· v«Öµ -1 Ö±½Ó»ØÊÕÉú³¤ ği¬m,²»Õ¼ÓÃ
function x712514_OnCreate( sceneId, growPointType, x, y, dur)
	local ItemBoxId = nil
	local delDur = dur - 60000;	--±¦Ïä»òÕäÊŞtoÕ ğµ ÏûÊ§Ê±¼ä
	
	-- ±¦ÏäÀïÓĞ¼¸cáiÎïÆ·
	local numIdx = x712514_GetTableIndexByOdd(x712514_g_DropNumTable)
	if(numIdx) then
		for i = 1, x712514_g_DropNumTable[numIdx].num do
			--Cái này ÎïÆ·ĞúngÊ²Ã´ÀàĞÍtoÕ ğµ ÎïÆ·
			local showIdx = x712514_GetTableIndexByOdd(x712514_g_DropTable)
			local dropNumIdx = nil
			local itemId = nil
			if(showIdx) then
				--Cái này ÀàĞÍtoÕ ğµ ÎïÆ·ÊıÁ¿Ğúng¼¸cái
				dropNumIdx = x712514_GetTableIndexByOdd(x712514_g_DropTable[showIdx].numOdd)
				if(dropNumIdx and 9 ~= x712514_g_DropTable[showIdx].itemType) then
					local itemNum = getn(x712514_g_DropTable[showIdx].idx)
					if(itemNum and 1<=itemNum) then
						local itemIdx = floor(random(1, itemNum))
						itemId = x712514_g_DropTable[showIdx].idx[itemIdx]
						--Ìí¼ÓµôÂäÏäºÍÎïÆ·µ½³¡¾°
						for k = 1, x712514_g_DropTable[showIdx].numOdd[dropNumIdx].num do
							if(nil == ItemBoxId) then
								ItemBoxId = ItemBoxEnterScene( x, y, growPointType, sceneId, QUALITY_MUST_BE_CHANGE,1, itemId )
								print( sceneId .. " Trß¶ng cänh s¯ (" .. x .. ", " .. y .. ") tÕo ra mµt v§t ph¦m "..
											 "("..x712514_g_DropNumTable[numIdx].num..")" )
							else
								AddItemToBox( sceneId, ItemBoxId, QUALITY_MUST_BE_CHANGE,1, itemId )
							end
						end
					end
				elseif(dropNumIdx and 9 == x712514_g_DropTable[showIdx].itemType) then
					local petIdx = floor(random(1, getn(x712514_g_DropTable[showIdx].idx)))
					local petId = x712514_g_DropTable[showIdx].idx[petIdx]
					--Ìí¼ÓÕäÊŞµ½³¡¾°
					for k = 1, x712514_g_DropTable[showIdx].numOdd[dropNumIdx].num do
						local PetObjId = nil
						PetObjId = CreatePetOnScene( sceneId, petId, x, y )
						SetCharacterDieTime( sceneId, PetObjId, delDur )
						print( sceneId .. " Trß¶ng cänh s¯ (" .. x .. ", " .. y .. ") tÕo ra mµt Trân thú "..
									 GetName( sceneId, PetObjId ) .. "." )
					end 
				end
			end --end of if(showIdx) then
			
			--¼ÇÂ¼ÎïÆ·µôÂä°üËù°üº¬toÕ ğµ ÄÚÈİ
			if(showIdx and dropNumIdx and itemId ~= nil) then
				if(9 ~= x712514_g_DropTable[showIdx].itemType) then
					local itemName;
					_,itemName,_ = GetItemInfoByItemId(itemId)
					print("V§t ph¦m bên trong có (loÕi "..x712514_g_DropTable[showIdx].itemType..")"..
								x712514_g_DropTable[showIdx].numOdd[dropNumIdx].num..
								" mµt ["..itemName.."].")
					itemNum = x712514_g_DropTable[showIdx].numOdd[dropNumIdx].num;
					LuaFnAuditItemCreate(sceneId, -1, itemNum, itemId, itemName, "T× bäo sß½ng tÕo ra");
				end
			end
			
		end -- end of for i = 1, x712514_g_DropNumTable[numIdx].num do
		
		--Éè¶¨»ØÊÕÊ±¼ä
		if(ItemBoxId) then
			SetItemBoxMaxGrowTime( sceneId, ItemBoxId, delDur )
			return 0	--Cái này ×ø±ê±»±¦ÏäÕ¼ÓÃÁË
		end
	end
	
	return -1	--Cái này ×ø±êÃ»ÓĞ±»Õ¼ÓÃ
end
--Éú³Éº¯Êı½áÊø**********************************************************************

--mµt ´Î´´½¨¶àcái±¦ÏätoÕ ğµ Íê³Éº¯Êı¿ªÊ¼****************************************************
function x712514_OnTickCreateFinish( sceneId, growPointType, tickCount )
	if(strlen(x712514_g_TickCreate_Msg) > 0) then
		--2006-8-22 14:37 µÈ´ıÏş½¡toÕ ğµ server¶Ô»°Æ½Ì¨
		print( sceneId .. " Trß¶ng cänh s¯ "..x712514_g_TickCreate_Msg)
	end
end
--mµt ´Î´´½¨¶àcái±¦ÏätoÕ ğµ Íê³Éº¯Êı½áÊø****************************************************

--´ò¿ªÇ°º¯Êı¿ªÊ¼
function x712514_OnOpen( sceneId, selfId, targetId )
--Tr· v«ÀàĞÍ
-- 0 ±íÊ¾´ò¿ª³É¹¦
end
--´ò¿ªÇ°º¯Êı½áÊø


--»ØÊÕº¯Êı¿ªÊ¼
function x712514_OnRecycle( sceneId, selfId, targetId )
--Tr· v«1,Éú³¤ ği¬m»ØÊÕ
	return 1
end
--»ØÊÕº¯Êı½áÊø

--´ò¿ªºóº¯Êı¿ªÊ¼
function x712514_OnProcOver( sceneId, selfId, targetId )
end

--´ò¿ªºóº¯Êı½áÊø
function x712514_OpenCheck( sceneId, selfId, AbilityId, AblityLevel )
	return OR_OK
end
