--ÕäÊŞ»¹Í¯µ¤[±ä»¯µ½Ä¿±êÕäÊŞÀàĞÍ]

--½Å±¾ºÅ
x300100_g_scriptId = 300100

--rulerId
--0	= ÆÕÍ¨¹æÔò
--1 = ÆÕÍ¨RMB¹æÔò
--2 = ìÅÒ«RMB¹æÔò
x300100_g_itemList = {}

---------ÁúÃ¨
x300100_g_itemList[30309150] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309150].petIds[5] = 7649;
x300100_g_itemList[30309150].petIds[45] = 7659;

x300100_g_itemList[30309163] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309163].petIds[5] = 7649;
x300100_g_itemList[30309163].petIds[45] = 7659;
x300100_g_itemList[30309163].petIds[55] = 7669;
x300100_g_itemList[30309163].petIds[65] = 7679;
x300100_g_itemList[30309163].petIds[75] = 7689;
x300100_g_itemList[30309163].petIds[85] = 7699;
--x300100_g_itemList[30309163].petIds[95] = 7709;

---------ĞÜÃ¨
x300100_g_itemList[30309151] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309151].petIds[5] = 7789;
x300100_g_itemList[30309151].petIds[45] = 7799;

x300100_g_itemList[30309164] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309164].petIds[5] = 7789;
x300100_g_itemList[30309164].petIds[45] = 7799;
x300100_g_itemList[30309164].petIds[55] = 7809;
x300100_g_itemList[30309164].petIds[65] = 7819;
x300100_g_itemList[30309164].petIds[75] = 7829;
x300100_g_itemList[30309164].petIds[85] = 7839;
--x300100_g_itemList[30309164].petIds[95] = 7849;

---------ºûµû
x300100_g_itemList[30309152] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309152].petIds[5] = 7929;
x300100_g_itemList[30309152].petIds[45] = 7939;

x300100_g_itemList[30309165] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309165].petIds[5] = 7929;
x300100_g_itemList[30309165].petIds[45] = 7939;
x300100_g_itemList[30309165].petIds[55] = 7949;
x300100_g_itemList[30309165].petIds[65] = 7959;
x300100_g_itemList[30309165].petIds[75] = 7969;
x300100_g_itemList[30309165].petIds[85] = 7979;
--x300100_g_itemList[30309165].petIds[95] = 7989;

---------ÎÏÅ£
x300100_g_itemList[30309153] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309153].petIds[5] = 7999;
x300100_g_itemList[30309153].petIds[45] = 8009;

x300100_g_itemList[30309166] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309166].petIds[5] = 7999;
x300100_g_itemList[30309166].petIds[45] = 8009;
x300100_g_itemList[30309166].petIds[55] = 8019;
x300100_g_itemList[30309166].petIds[65] = 8029;
x300100_g_itemList[30309166].petIds[75] = 8039;
x300100_g_itemList[30309166].petIds[85] = 8049;
--x300100_g_itemList[30309166].petIds[95] = 8059;

---------Ğ«×Ó
x300100_g_itemList[30309154] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309154].petIds[5] = 8069;
x300100_g_itemList[30309154].petIds[45] = 8079;

x300100_g_itemList[30309167] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309167].petIds[5] = 8069;
x300100_g_itemList[30309167].petIds[45] = 8079;
x300100_g_itemList[30309167].petIds[55] = 8089;
x300100_g_itemList[30309167].petIds[65] = 8099;
x300100_g_itemList[30309167].petIds[75] = 8109;
x300100_g_itemList[30309167].petIds[85] = 8119;
--x300100_g_itemList[30309167].petIds[95] = 8129;

---------ó¦Ğ·
x300100_g_itemList[30309155] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309155].petIds[5] = 7859;
x300100_g_itemList[30309155].petIds[45] = 7869;

x300100_g_itemList[30309168] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309168].petIds[5] = 7859;
x300100_g_itemList[30309168].petIds[45] = 7869;
x300100_g_itemList[30309168].petIds[55] = 7879;
x300100_g_itemList[30309168].petIds[65] = 7889;
x300100_g_itemList[30309168].petIds[75] = 7899;
x300100_g_itemList[30309168].petIds[85] = 7909;
--x300100_g_itemList[30309168].petIds[95] = 7919;

---------Ï¬Äñ
x300100_g_itemList[30309156] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309156].petIds[5] = 7719;
x300100_g_itemList[30309156].petIds[45] = 7729;

x300100_g_itemList[30309169] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309169].petIds[5] = 7719;
x300100_g_itemList[30309169].petIds[45] = 7729;
x300100_g_itemList[30309169].petIds[55] = 7739;
x300100_g_itemList[30309169].petIds[65] = 7749;
x300100_g_itemList[30309169].petIds[75] = 7759;
x300100_g_itemList[30309169].petIds[85] = 7769;
--x300100_g_itemList[30309169].petIds[95] = 7779;

---------Ñ¼×ìÊŞ
x300100_g_itemList[30309157] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309157].petIds[5] = 7509;
x300100_g_itemList[30309157].petIds[45] = 7519;

x300100_g_itemList[30309170] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309170].petIds[5] = 7509;
x300100_g_itemList[30309170].petIds[45] = 7519;
x300100_g_itemList[30309170].petIds[55] = 7529;
x300100_g_itemList[30309170].petIds[65] = 7539;
x300100_g_itemList[30309170].petIds[75] = 7549;
x300100_g_itemList[30309170].petIds[85] = 7559;
--x300100_g_itemList[30309170].petIds[95] = 7569;

---------Ñ©ºü
x300100_g_itemList[30309158] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309158].petIds[5] = 7579;
x300100_g_itemList[30309158].petIds[45] = 7589;

x300100_g_itemList[30309171] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309171].petIds[5] = 7579;
x300100_g_itemList[30309171].petIds[45] = 7589;
x300100_g_itemList[30309171].petIds[55] = 7599;
x300100_g_itemList[30309171].petIds[65] = 7609;
x300100_g_itemList[30309171].petIds[75] = 7619;
x300100_g_itemList[30309171].petIds[85] = 7629;
--x300100_g_itemList[30309171].petIds[95] = 7639;

---------Ğ¡õø
x300100_g_itemList[30309159] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309159].petIds[5] = 8139;
x300100_g_itemList[30309159].petIds[45] = 8149;

x300100_g_itemList[30309172] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309172].petIds[5] = 8139;
x300100_g_itemList[30309172].petIds[45] = 8149;
x300100_g_itemList[30309172].petIds[55] = 8159;
x300100_g_itemList[30309172].petIds[65] = 8169;
x300100_g_itemList[30309172].petIds[75] = 8179;
x300100_g_itemList[30309172].petIds[85] = 8189;
--x300100_g_itemList[30309172].petIds[95] = 8199;

---------¼×³æ
x300100_g_itemList[30309160] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309160].petIds[5] = 8209;
x300100_g_itemList[30309160].petIds[45] = 8219;

x300100_g_itemList[30309173] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309173].petIds[5] = 8209;
x300100_g_itemList[30309173].petIds[45] = 8219;
x300100_g_itemList[30309173].petIds[55] = 8229;
x300100_g_itemList[30309173].petIds[65] = 8239;
x300100_g_itemList[30309173].petIds[75] = 8249;
x300100_g_itemList[30309173].petIds[85] = 8259;
--x300100_g_itemList[30309173].petIds[95] = 8269;

---------µ±ìè
x300100_g_itemList[30309161] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309161].petIds[5] = 8279;
x300100_g_itemList[30309161].petIds[45] = 8289;

x300100_g_itemList[30309174] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309174].petIds[5] = 8279;
x300100_g_itemList[30309174].petIds[45] = 8289;
x300100_g_itemList[30309174].petIds[55] = 8299;
x300100_g_itemList[30309174].petIds[65] = 8309;
x300100_g_itemList[30309174].petIds[75] = 8319;
x300100_g_itemList[30309174].petIds[85] = 8329;
--x300100_g_itemList[30309174].petIds[95] = 8339;

---------º£µÁÊó
x300100_g_itemList[30309162] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309162].petIds[5] = 8349;
x300100_g_itemList[30309162].petIds[45] = 8359;

x300100_g_itemList[30309175] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309175].petIds[5] = 8349;
x300100_g_itemList[30309175].petIds[45] = 8359;
x300100_g_itemList[30309175].petIds[55] = 8369;
x300100_g_itemList[30309175].petIds[65] = 8379;
x300100_g_itemList[30309175].petIds[75] = 8389;
x300100_g_itemList[30309175].petIds[85] = 8399;
--x300100_g_itemList[30309175].petIds[95] = 8409;

---------±¦ÏäÍ¯×Ó
x300100_g_itemList[30309176] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309176].petIds[5] = 8419;
x300100_g_itemList[30309176].petIds[45] = 8429;

x300100_g_itemList[30309177] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309177].petIds[5] = 8419;
x300100_g_itemList[30309177].petIds[45] = 8429;
x300100_g_itemList[30309177].petIds[55] = 8439;
x300100_g_itemList[30309177].petIds[65] = 8449;
x300100_g_itemList[30309177].petIds[75] = 8459;
x300100_g_itemList[30309177].petIds[85] = 8469;
--x300100_g_itemList[30309177].petIds[95] = 8479;

---------Ê÷´üĞÜ
x300100_g_itemList[30309178] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309178].petIds[5] = 8489;
x300100_g_itemList[30309178].petIds[45] = 8499;

x300100_g_itemList[30309179] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309179].petIds[5] = 8489;
x300100_g_itemList[30309179].petIds[45] = 8499;
x300100_g_itemList[30309179].petIds[55] = 8509;
x300100_g_itemList[30309179].petIds[65] = 8519;
x300100_g_itemList[30309179].petIds[75] = 8529;
x300100_g_itemList[30309179].petIds[85] = 8539;
--x300100_g_itemList[30309179].petIds[95] = 8549;

---------»¶ÀÖÖí
x300100_g_itemList[30309180] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309180].petIds[5] = 8569;
x300100_g_itemList[30309180].petIds[45] = 8579;

x300100_g_itemList[30309181] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309181].petIds[5] = 8569;
x300100_g_itemList[30309181].petIds[45] = 8579;
x300100_g_itemList[30309181].petIds[55] = 8589;
x300100_g_itemList[30309181].petIds[65] = 8599;
x300100_g_itemList[30309181].petIds[75] = 8609;
x300100_g_itemList[30309181].petIds[85] = 8619;
--x300100_g_itemList[30309181].petIds[95] = 8629;

---------ÌÆ×°Êó
x300100_g_itemList[30309182] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309182].petIds[5] = 8749;
x300100_g_itemList[30309182].petIds[45] = 8759;

x300100_g_itemList[30309183] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309183].petIds[5] = 8749;
x300100_g_itemList[30309183].petIds[45] = 8759;
x300100_g_itemList[30309183].petIds[55] = 8769;
x300100_g_itemList[30309183].petIds[65] = 8779;
x300100_g_itemList[30309183].petIds[75] = 8789;
x300100_g_itemList[30309183].petIds[85] = 8799;
--x300100_g_itemList[30309183].petIds[95] = 8809;

---------ÄêÊŞ
x300100_g_itemList[30309184] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309184].petIds[5] = 8819;
x300100_g_itemList[30309184].petIds[45] = 8829;

x300100_g_itemList[30309185] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309185].petIds[5] = 8819;
x300100_g_itemList[30309185].petIds[45] = 8829;
x300100_g_itemList[30309185].petIds[55] = 8839;
x300100_g_itemList[30309185].petIds[65] = 8849;
x300100_g_itemList[30309185].petIds[75] = 8859;
x300100_g_itemList[30309185].petIds[85] = 8869;
--x300100_g_itemList[30309185].petIds[95] = 8879;

---------Ô§Ñì
x300100_g_itemList[30309186] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309186].petIds[5] = 8889;
x300100_g_itemList[30309186].petIds[45] = 8899;

x300100_g_itemList[30309187] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309187].petIds[5] = 8889;
x300100_g_itemList[30309187].petIds[45] = 8899;
x300100_g_itemList[30309187].petIds[55] = 8909;
x300100_g_itemList[30309187].petIds[65] = 8919;
x300100_g_itemList[30309187].petIds[75] = 8929;
x300100_g_itemList[30309187].petIds[85] = 8939;
--x300100_g_itemList[30309187].petIds[95] = 8949;

---------±ÈÒíÄñ
x300100_g_itemList[30309188] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309188].petIds[5] = 22219;
x300100_g_itemList[30309188].petIds[45] = 22229;

x300100_g_itemList[30309189] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309189].petIds[5] = 22219;
x300100_g_itemList[30309189].petIds[45] = 22229;
x300100_g_itemList[30309189].petIds[55] = 22239;
x300100_g_itemList[30309189].petIds[65] = 22249;
x300100_g_itemList[30309189].petIds[75] = 22259;
x300100_g_itemList[30309189].petIds[85] = 22269;
--x300100_g_itemList[30309189].petIds[95] = 22279;

---------´ô´ôÅ£
x300100_g_itemList[30309190] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309190].petIds[5] = 22289;
x300100_g_itemList[30309190].petIds[45] = 22299;

x300100_g_itemList[30309191] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309191].petIds[5] = 22289;
x300100_g_itemList[30309191].petIds[45] = 22299;
x300100_g_itemList[30309191].petIds[55] = 22309;
x300100_g_itemList[30309191].petIds[65] = 22319;
x300100_g_itemList[30309191].petIds[75] = 22329;
x300100_g_itemList[30309191].petIds[85] = 22339;
----------Go×Ğ
x300100_g_itemList[30309192] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309192].petIds[5] = 22499;
x300100_g_itemList[30309192].petIds[45] = 22509;

x300100_g_itemList[30309193] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309193].petIds[5] = 22499;
x300100_g_itemList[30309193].petIds[45] = 22509;
x300100_g_itemList[30309193].petIds[55] = 22519;
x300100_g_itemList[30309193].petIds[65] = 22529;
x300100_g_itemList[30309193].petIds[75] = 22539;
x300100_g_itemList[30309193].petIds[85] = 22549;

--x300100_g_itemList[30309191].petIds[95] = 22349;
x300100_g_ItemName = 0
--**********************************
-- ·µ»Ø1£º¼¼ÄÜÀàËÆµÄÎïÆ·£¬¿ÉÒÔ¼ÌĞøÀàËÆ¼¼ÄÜµÄÖ´ĞĞ£»·µ»Ø0£ºÖ´ĞĞ OnDefaultEvent¡£
--**********************************
function x300100_IsSkillLikeScript( sceneId, selfId )
	return 1
end

--**********************************
-- ·µ»Ø1£ºÒÑ¾­È¡Ïû¶ÔÓ¦Ğ§¹û£¬²»ÔÙÖ´ĞĞºóĞø²Ù×÷£»·µ»Ø0£ºÃ»ÓĞ¼ì²âµ½Ïà¹ØĞ§¹û£¬¼ÌĞøÖ´ĞĞ¡£
--**********************************
function x300100_CancelImpacts( sceneId, selfId )
	return 0
end

--**********************************
-- Ìõ¼ş¼ì²âÈë¿Ú£º·µ»Ø1£ºÌõ¼ş¼ì²âÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÌõ¼ş¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x300100_OnConditionCheck( sceneId, selfId )
	-- Ğ£ÑéÊ¹ÓÃµÄÎïÆ·
	if LuaFnVerifyUsedItem( sceneId, selfId ) ~= 1 then
		return 0
	end
	
	local check = x300100_CanOperate(sceneId, selfId);
	if not check or check ~= 1 then
		return 0;
	end
	return 1
end

--**********************************
--ÏûºÄ¼ì²â¼°´¦ÀíÈë¿Ú£¬¸ºÔğÏûºÄµÄ¼ì²âºÍÖ´ĞĞ£º
--·µ»Ø1£ºÏûºÄ´¦ÀíÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÏûºÄ¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x300100_OnDeplete( sceneId, selfId )
	
	local bagpos = LuaFnGetBagIndexOfUsedItem( sceneId, selfId )
	x300100_g_ItemName = GetBagItemTransfer( sceneId, selfId, bagpos )									
	if LuaFnDepletingUsedItem( sceneId, selfId ) > 0 then
		return 1
	end

	return 0
end

--**********************************
--Ö»»áÖ´ĞĞÒ»´ÎÈë¿Ú£º
--¾ÛÆøºÍË²·¢¼¼ÄÜ»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¾ÛÆø½áÊø²¢ÇÒ¸÷ÖÖÌõ¼ş¶¼Âú×ãµÄÊ±ºò£©£¬¶øÒıµ¼
--¼¼ÄÜÒ²»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¼¼ÄÜµÄÒ»¿ªÊ¼£¬ÏûºÄ³É¹¦Ö´ĞĞÖ®ºó£©¡£
--·µ»Ø1£º´¦Àí³É¹¦£»·µ»Ø0£º´¦ÀíÊ§°Ü¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜÉúĞ§Ò»´ÎµÄÈë¿Ú
--**********************************
function x300100_OnActivateOnce( sceneId, selfId )
	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300100_g_itemList[itemTblIndex];
	if not petItem then
		x300100_NotifyFailTips(sceneId, selfId, "Chßa m· ğÕo cø, không th¬ sØ døng.");
		return 0;
	end

	local petGUID_H = LuaFnGetHighSectionOfTargetPetGuid( sceneId, selfId );
	local petGUID_L = LuaFnGetLowSectionOfTargetPetGuid( sceneId, selfId );
	if not petGUID_H or not petGUID_L then
		x300100_NotifyFailTips(sceneId, selfId, "Chßa tìm ğßşc trân thú chï ğ¸nh.");
		return 0;
	end
	
	local check = x300100_CanOperate(sceneId, selfId);
	if not check or check ~= 1 then
		return 0;
	end
	
	local curPetTemplateId = LuaFnGetPetDataIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	local curPetTakeLevel = GetPetTakeLevel(curPetTemplateId);
	local needMoney = LuaFnGetPetHuanTongCost(sceneId, curPetTakeLevel);
	needMoney = needMoney / 100;
	local costMoneyRet = LuaFnCostMoneyWithPriority(sceneId, selfId, needMoney);
	if not costMoneyRet or costMoneyRet < 0 then
		x300100_NotifyFailTips(sceneId, selfId, "Không ğü ngân lßşng.");
		return 0;
	end
	
	local delRet = LuaFnDeletePetByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not delRet or delRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "Kh¤u tr× trân thú th¤t bÕi.");
		return 0;
	end
	
	local createRet, PetID_H, PetID_L = LuaFnCreatePetToHuman(sceneId, selfId, petItem.petIds[curPetTakeLevel], 1, petItem.rulerId);
	if not createRet or createRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "Thêm m¾i trân thú th¤t bÕi.");
		return 0;
	end
	
	-- [ QUFEI 2007-11-21 19:22 UPDATE BugID 28170 ]
	local PlayerName = GetName(sceneId, selfId)				
	local PetName = LuaFnGetPetTransferByGUID( sceneId, selfId, PetID_H, PetID_L )
	-- ·¢ËÍÏµÍ³¹«¸æ
	local strText = ""
	-- zchw
	if (itemTblIndex == 30309186) or (itemTblIndex == 30309187) then --Èç¹ûÊÇ»¹Í¯µ¤£ºÔ§Ñì
		strText = format("#{HT10}#{_INFOUSR%s}#{HT11}#{_INFOMSG%s}#{HT12}#{_INFOMSG%s}#{HT13}", PlayerName, x300100_g_ItemName, PetName);	
	else
		local inforand = random(3)		
		if inforand == 1 then
			strText = format("#{HT01}#{_INFOMSG%s}#{HT02}#{_INFOMSG%s}#{HT03}#{_INFOUSR%s}#{HT04}", x300100_g_ItemName, PetName, PlayerName )
		elseif inforand == 2 then
			strText = format("#{HT05}#{_INFOUSR%s}#{HT06}#{_INFOMSG%s}#{HT07}#{_INFOMSG%s}#H#{HSLJJF_2}", PlayerName, x300100_g_ItemName, PetName )
		else
			strText = format("#{_INFOUSR%s}#{HT08}#{_INFOMSG%s}#{HT09}#{_INFOMSG%s}#H#{HSLJJF_2}", PlayerName, x300100_g_ItemName, PetName )
		end
	end
	
	
	BroadMsgByChatPipe(sceneId,selfId, strText, 4)				 											
	
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 18, 0);
	return 1
end

--**********************************
--Òıµ¼ĞÄÌø´¦ÀíÈë¿Ú£º
--Òıµ¼¼¼ÄÜ»áÔÚÃ¿´ÎĞÄÌø½áÊøÊ±µ÷ÓÃÕâ¸ö½Ó¿Ú¡£
--·µ»Ø£º1¼ÌĞøÏÂ´ÎĞÄÌø£»0£ºÖĞ¶ÏÒıµ¼¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜĞÄÌøÊ±ÉúĞ§µÄÈë¿Ú
--**********************************
function x300100_OnActivateEachTick( sceneId, selfId )
	return 1
end

--**********************************
-- ĞÑÄ¿Ê§°ÜÌáÊ¾
--**********************************
function x300100_NotifyFailTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end

--**********************************
-- ¼ì²éÄÜ·ñ¶ÔÕäÊŞ½øĞĞ»¹Í¯
--**********************************
function x300100_CanOperate(sceneId, selfId)

	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300100_g_itemList[itemTblIndex];
	if not petItem then
		x300100_NotifyFailTips(sceneId, selfId, "Chßa m· ğÕo cø, không th¬ sØ døng.");
		return 0;
	end

	local petGUID_H = LuaFnGetHighSectionOfTargetPetGuid( sceneId, selfId );
	local petGUID_L = LuaFnGetLowSectionOfTargetPetGuid( sceneId, selfId );
	if not petGUID_H or not petGUID_L then
		x300100_NotifyFailTips(sceneId, selfId, "Chßa tìm ğßşc trân thú chï ğ¸nh.");
		return 0;
	end
	
	local curPetTemplateId = LuaFnGetPetDataIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not curPetTemplateId or curPetTemplateId < 0 then
		x300100_NotifyFailTips(sceneId, selfId, "Trân thú chï ğ¸nh không th¬ sØ døng.");
		return 0;
	end
	
	local checkPetRet = LuaFnIsPetAvailableByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not checkPetRet or checkPetRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "Trân thú khóa ğ¸nh không th¬ tiªn hành thao tác này.");
		return 0;
	end
	
	local spouseGUID_H, spouseGUID_L = LuaFnGetPetSpouseGUIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not spouseGUID_H or not spouseGUID_L or spouseGUID_H ~= 0 or spouseGUID_L ~= 0 then
		x300100_NotifyFailTips(sceneId, selfId, "Ğã có trân thú ph¯i ngçu không th¬ tiªn hành thao tác này.");
		return 0;
	end
	
	local petType = LuaFnGetPetTypeByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not petType or petType == 1 then
		x300100_NotifyFailTips(sceneId, selfId, "Trân thú Biªn D¸ và trân thú ğ¶i thÑ 2 không th¬ tiªn hành thao tác này.");
		return 0;
	end

	local curPetTakeLevel = GetPetTakeLevel(curPetTemplateId);
	if not curPetTakeLevel or petItem.minPetLevel > curPetTakeLevel or curPetTakeLevel > petItem.maxPetLevel then
		x300100_NotifyFailTips(sceneId, selfId, "Chï có th¬ ğ¯i v¾i "..petItem.minPetLevel.." Ğªn "..petItem.maxPetLevel.." cüa trân thú tiªn hành thao tác này.");
		return 0;
	end
	
	if not petItem.petIds[curPetTakeLevel] then
		x300100_NotifyFailTips(sceneId, selfId, "Không th¬ mang theo v¾i ğÆng c¤p là "..curPetTakeLevel.." cüa trân thú tiªn hành thao tác này.");
		return 0;
	end
	
	local humanMoney = LuaFnGetMoney(sceneId, selfId) +  GetMoneyJZ(sceneId, selfId);   --½»×ÓÆÕ¼° Vega
	local needMoney = LuaFnGetPetHuanTongCost(sceneId, curPetTakeLevel);
	needMoney = needMoney / 100;
	if not humanMoney or not needMoney or needMoney < 0 or humanMoney < 0 or humanMoney < needMoney then
		x300100_NotifyFailTips(sceneId, selfId, "Không ğü ngân lßşng.");
		return 0;
	end
	
	return 1
end

