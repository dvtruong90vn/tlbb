--ÂåÑôNPC
--Öî¸ð¿×ÁÁ
--ËãÃü£¬ÒÔºó¿ÉÄÜ³ÉÎªÑ­»·ÈÎÎñ

--½Å±¾ºÅ
x000077_g_ScriptId = 000077

x000077_g_ControlScript = 050026


--¶Ò»»ÁÐ±í
x000077_g_ChangeLst	=
{
	--Íæ¼Ò¿ÉµÃµ½µÄÎïÆ·£¬¶Ò»»ËùÐèÎïÆ·£¬¶Ò»»ËùÐèÎïÆ·ÊýÁ¿
	--4¼¶
	[1]	= { id = 50401002, NeedItm = 30504031, NeedNum = 72 },
	[2]	= { id = 50401001, NeedItm = 30504031, NeedNum = 72 },
	[3]	= { id = 50403001, NeedItm = 30504031, NeedNum = 72 },
	[4]	= { id = 50414001, NeedItm = 30504031, NeedNum = 72 },
	[5]	= { id = 50402006, NeedItm = 30504031, NeedNum = 72 },
	[6]	= { id = 50402007, NeedItm = 30504031, NeedNum = 72 },
	[7]	= { id = 50402005, NeedItm = 30504031, NeedNum = 72 },
	[8]	= { id = 50402008, NeedItm = 30504031, NeedNum = 72 },
	[9]	= { id = 50413006, NeedItm = 30504031, NeedNum = 72 },
	[10] = { id = 50413004, NeedItm = 30504031, NeedNum = 72 },
	
	
	--5¼¶
	[11]	= { id = 50501002, NeedItm = 30504032, NeedNum = 72 },
	[12]	= { id = 50501001, NeedItm = 30504032, NeedNum = 72 },
	[13]	= { id = 50503001, NeedItm = 30504032, NeedNum = 72 },
	[14]	= { id = 50514001, NeedItm = 30504032, NeedNum = 72 },
	[15]	= { id = 50502006, NeedItm = 30504032, NeedNum = 72 },
	[16]	= { id = 50502007, NeedItm = 30504032, NeedNum = 72 },
	[17]	= { id = 50502005, NeedItm = 30504032, NeedNum = 72 },
	[18]	= { id = 50502008, NeedItm = 30504032, NeedNum = 72 },
	[19]	= { id = 50513006, NeedItm = 30504032, NeedNum = 72 },
	[20]	= { id = 50513004, NeedItm = 30504032, NeedNum = 72 },
	
	--6¼¶
	[21]	= { id = 50601002, NeedItm = 30504033, NeedNum = 72 },
	[22]	= { id = 50601001, NeedItm = 30504033, NeedNum = 72 },
	[23]	= { id = 50603001, NeedItm = 30504033, NeedNum = 72 },
	[24]	= { id = 50614001, NeedItm = 30504033, NeedNum = 72 },
	[25]	= { id = 50602006, NeedItm = 30504033, NeedNum = 72 },
	[26]	= { id = 50602007, NeedItm = 30504033, NeedNum = 72 },
	[27]	= { id = 50602005, NeedItm = 30504033, NeedNum = 72 },
	[28]	= { id = 50602008, NeedItm = 30504033, NeedNum = 72 },
	[29]	= { id = 50613006, NeedItm = 30504033, NeedNum = 72 },
	[30]	= { id = 50613004, NeedItm = 30504033, NeedNum = 72 },
	
	--7¼¶
	[31]	= { id = 50701002, NeedItm = 30504034, NeedNum = 72 },
	[32]	= { id = 50701001, NeedItm = 30504034, NeedNum = 72 },
	[33]	= { id = 50703001, NeedItm = 30504034, NeedNum = 72 },
	[34]	= { id = 50714001, NeedItm = 30504034, NeedNum = 72 },
	[35]	= { id = 50702006, NeedItm = 30504034, NeedNum = 72 },
	[36]	= { id = 50702007, NeedItm = 30504034, NeedNum = 72 },
	[37]	= { id = 50702005, NeedItm = 30504034, NeedNum = 72 },
	[38]	= { id = 50702008, NeedItm = 30504034, NeedNum = 72 },
	[39]	= { id = 50713006, NeedItm = 30504034, NeedNum = 72 },
	[40]	= { id = 50713004, NeedItm = 30504034, NeedNum = 72 },

	--8¼¶
	[41]	= { id = 50801002, NeedItm = 30504035, NeedNum = 72 },
	[42]	= { id = 50801001, NeedItm = 30504035, NeedNum = 72 },
	[43]	= { id = 50803001, NeedItm = 30504035, NeedNum = 72 },
	[44]	= { id = 50814001, NeedItm = 30504035, NeedNum = 72 },
	[45]	= { id = 50802006, NeedItm = 30504035, NeedNum = 72 },
	[46]	= { id = 50802007, NeedItm = 30504035, NeedNum = 72 },
	[47]	= { id = 50802005, NeedItm = 30504035, NeedNum = 72 },
	[48]	= { id = 50802008, NeedItm = 30504035, NeedNum = 72 },
	[49]	= { id = 50813006, NeedItm = 30504035, NeedNum = 72 },
	[50]	= { id = 50813004, NeedItm = 30504035, NeedNum = 72 },

	--9¼¶
	[51]	= { id = 50901002, NeedItm = 30504036, NeedNum = 72 },
	[52]	= { id = 50901001, NeedItm = 30504036, NeedNum = 72 },
	[53]	= { id = 50903001, NeedItm = 30504036, NeedNum = 72 },
	[54]	= { id = 50914001, NeedItm = 30504036, NeedNum = 72 },
	[55]	= { id = 50902006, NeedItm = 30504036, NeedNum = 72 },
	[56]	= { id = 50902007, NeedItm = 30504036, NeedNum = 72 },
	[57]	= { id = 50902005, NeedItm = 30504036, NeedNum = 72 },
	[58]	= { id = 50902008, NeedItm = 30504036, NeedNum = 72 },
	[59]	= { id = 50913006, NeedItm = 30504036, NeedNum = 72 },
	[60]	= { id = 50913004, NeedItm = 30504036, NeedNum = 72 },
}

--**********************************
--ÊÂ¼þ½»»¥Èë¿Ú
--**********************************
function x000077_OnDefaultEvent( sceneId, selfId,targetId )

	BeginEvent(sceneId)
	
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 4", 6, 100 )
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 5", 6, 200 )
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 6", 6, 300 )
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 7", 6, 400 )
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 8", 6, 500 )
		AddNumText( sceneId, x000077_g_ControlScript, "Dùng Bäo ThÕch Toán Phiªn ð±i l¤y bäo thÕch c¤p 9", 6, 600 )
		
	  if CallScriptFunction( x000077_g_ControlScript, "CheckRightTime", sceneId) == 1 then
			AddText(sceneId, "#{CHRISTMAS_LUOYANG_HTJS_1}")
			CallScriptFunction( x000077_g_ControlScript, "OnEnumerate",sceneId, selfId, targetId )
		else
			local	i=random(0,1)
		  if	i<=0	 then
			  AddText(sceneId,"#{OBJ_luoyang_0023}")
		  else
			  AddText(sceneId,"CÞ nào ðÕi phú ðÕi ð¡t ti«n bäo tß¾ng a! Ngß½i nhß v§y có phúc  nhân không ngÕi phó mß¶i hai quë kim ði?")
		  end
		end		
			
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

function x000077_OnEventRequest( sceneId, selfId, targetId, eventId )

	local key = GetNumText();


	if 100 == key or 200 == key or 300 == key or 400 == key or 500 == key or 600 == key then
		BeginEvent(sceneId)
		AddText( sceneId, "#{CHANGE_BAOSHI_KONGMIMG}" )
		AddNumText( sceneId, x000077_g_ControlScript, "H± Nhãn ThÕch", 6, 1 + key )--hnt
		AddNumText( sceneId, x000077_g_ControlScript, "Miêu Nhãn ThÕch", 6, 2 + key )--mnt
		AddNumText( sceneId, x000077_g_ControlScript, "TØ Ng÷c", 6, 3 + key )--tn
		AddNumText( sceneId, x000077_g_ControlScript, "T± Mçu Løc", 6, 4 + key )--tml
		AddNumText( sceneId, x000077_g_ControlScript, "Thu¥n T¸nh Lam Tinh ThÕch", 6, 5 + key )--t-ltt
		AddNumText( sceneId, x000077_g_ControlScript, "Thu¥n T¸nh H°ng Tinh ThÕch", 6, 6 + key )--t-htt
		AddNumText( sceneId, x000077_g_ControlScript, "Thu¥n T¸nh Hoàng Tinh ThÕch", 6, 7 + key )--t-htt
		AddNumText( sceneId, x000077_g_ControlScript, "Thu¥n T¸nh Løc Tinh ThÕch", 6, 8 + key )--t-lutt
		AddNumText( sceneId, x000077_g_ControlScript, "Huyªt Tinh ThÕch", 6, 9 + key )--htt
		AddNumText( sceneId, x000077_g_ControlScript, "H°ng Bäo ThÕch", 6, 10 + key )--hbt
				
		EndEvent( sceneId )
		DispatchEventList( sceneId, selfId, targetId )
		
	else
			
			x000077_OnMyChange( sceneId, selfId, targetId, key )		
				
	end
	
	if eventId == x000077_g_ControlScript then
		CallScriptFunction( x000077_g_ControlScript, "OnDefaultEvent",sceneId, selfId, targetId )
		return
	end

end


--**********************************
--¶Ò»»
--**********************************
function x000077_OnMyChange( sceneId, selfId, targetId, key )

	local num = floor(key/100);
	local numMod = mod(key,100);
	local index = (num-1)*10 + numMod
	
	local unt = x000077_g_ChangeLst[index]
	
	--ÐÐÎªÈÕÖ¾
	
	if  unt == nil then
		return
	end
	
	if LuaFnGetAvailableItemCount( sceneId, selfId, unt.NeedItm ) < unt.NeedNum then
	
		local strMsg = format("Ð±i #H#{_ITEM%d}#W c¥n 72 cái #H#{_ITEM%d}#W, nguyên li®u cüa ngß½i không ðü ", unt.id, unt.NeedItm)
		
		x000077_MsgBox( sceneId, selfId, targetId, strMsg )
		return
	end
	
	BeginAddItem( sceneId )
	AddItem( sceneId, unt.id, 1 )
	if EndAddItem( sceneId, selfId ) > 0 then
		if LuaFnDelAvailableItem( sceneId, selfId, unt.NeedItm, unt.NeedNum ) == 1 then
			AddItemListToHuman( sceneId, selfId )
		else
			x000077_MsgBox( sceneId, selfId, targetId, "Th¤t bÕi" )
			return
		end
	else
		x000077_MsgBox( sceneId, selfId, targetId, "Túi ðeo thiªu không gian" )
		return
	end
	
	local strMsg = format("Ð±i thành công, ngß½i nh§n ðßþc #H#{_ITEM%d}#W", unt.id)
	
	x000077_MsgBox( sceneId, selfId, targetId, strMsg )
	
	--ÐÐÎªÈÕÖ¾
	local strLog =  format( "change gem gem:%d gem scrap:%d", unt.id, unt.NeedItm)
	AuditChangeGem(sceneId, selfId, strLog)
	  
	--local	szTran	= GetItemTransfer( sceneId, selfId, 0 )
	--local szUser	= "#{_INFOUSR"..GetName( sceneId, selfId ).."}"
	--local szItem	= "#{_INFOMSG"..szTran.."}"
	--local	szMsg		= format( "#W%s#cff99ccÀú¾¡Ç§ÐÁÎª#GÂåÑô£¨111£¬163£©#Y¹¨²ÊÀö#cff99ccÕÒÆëÁË#Y¹Å´ÉËéÆ¬#cff99cc£¬¹¨²ÊÀöÏ×ÉÏ%s×÷Îª¸ÐÐ»¡£", szUser, szItem )
	--x000077_MsgBox( sceneId, selfId, targetId, "    Äú³É¹¦µÄ¶Ò»»ÁË"..GetItemName( sceneId, unt.id ).."¡£" )
	--BroadMsgByChatPipe( sceneId, selfId, szMsg, 4 )

end

--**********************************
--Message Box
--**********************************
function x000077_MsgBox( sceneId, selfId, targetId, str )

	BeginEvent( sceneId )
		AddText( sceneId, str )
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, targetId )
	
end
