 --Nhi®m vø sß môn

--MisDescBegin
--½Å±¾ºÅ
x229003_g_ScriptId = 229003

--Tiªp thøÈÎÎñNPCÊôÐÔ
x229003_g_Position_X=95.9834
x229003_g_Position_Z=86.7892
x229003_g_SceneID=15
x229003_g_AccomplishNPC_Name="Mãnh Long"

--Ç°ÌáÈÎÎñ
--g_MissionIdPre =

--Møc tiêu nhi®m vønpc
x229003_g_Name	= "Mãnh Long"

--ÈÎÎñºÅ
x229003_g_MissionId = 1090

--ÈÎÎñ¹éÀà
x229003_g_MissionKind = 26

--ÐÆng c¤p nhi®m vø 
x229003_g_MissionLevel = 10000

--Ðúng·ñÐúngTinhÓ¢ÈÎÎñ
x229003_g_IfMissionElite = 0

--ÏÂÃæ¼¸ÏîÐúng¶¯Ì¬ÏÔÊ¾toÕ ðµ ÄÚÈÝ,ÓÃÓÚTÕi ÈÎÎñÁÐ±íÖÐ¶¯Ì¬ÏÔÊ¾ÈÎÎñÇé¿ö**********************
--ÈÎÎñÐúng·ñÒÑ¾­Íê³É
x229003_g_IsMissionOkFail = 0		--±äÁ¿toÕ ðµ µÚ0Î»

--ÒÔÉÏÐúng¶¯Ì¬**************************************************************

--ÈÎÎñ±äÁ¿µÚmµt Î»ÓÃÀ´´æ´¢Ëæ»ú ði¬mµ½toÕ ðµ ½Å±¾ºÅ

--ÈÎÎñÎÄ±¾ÃèÊö
x229003_g_MissionName="Nhi®m vø sß môn"
x229003_g_MissionInfo=""  --ÈÎÎñÃèÊö
x229003_g_MissionTarget = "%f"
x229003_g_ContinueInfo="Làm t¯t l¡m"		--Î´Hoàn t¤t nhi®m vøtoÕ ðµ npc¶Ô»°
x229003_g_MissionComplete="Vi®c ta giao ðã hoàn thành chßa?"					--Hoàn t¤t nhi®m vønpcËµ»°toÕ ðµ »°
x229003_g_MissionRound=17
x229003_g_DoubleExp = 48
x229003_g_AccomplishCircumstance = 1

x229003_g_ShimenTypeIndex = 1                                                  
x229003_g_Parameter_Kill_AllRandom={{id=7,numa=3,numb=3,bytenuma=0,bytenumb=1}}
x229003_g_Parameter_Item_IDRandom={{id=6,num=5}}                               
x229003_g_NpcIdIndicator={{key=2,npcIdIndex=5},{key=9,npcIdIndex=7}}                              

--ÓÃÀ´±£´æ×Ö·û´®¸ñÊ½»¯toÕ ðµ Êý¾Ý
x229003_g_FormatList = {
								"Lâu l¡m không g£p %n r°i, nh¾ quá ði. Ðây %s là chút lòng thành cüa ta, xin ngß½i hãy ðßa t¾i giúp ta. #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn núi Nga My tìm #RDß½ng TÑ Nß½ng #W#{_INFOAIM86,142,15, Dß½ng TÑ Nß½ng}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"Cüa ta %i sao không th¤y ðâu? Nªu ngß½i có th¬ giúp ta tìm lÕi, ta s¨ không bÕc ðãi ngß½i. #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn núi Nga My tìm #RDß½ng TÑ Nß½ng #W#{_INFOAIM86,142,15, Dß½ng TÑ Nß½ng}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"%n làm ði«u ác, ta phäi ði dÕy bäo, ðáng tiªc không có th¶i gian, ngß½i có th¬ làm thay ðßþc không? #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ ðªn núi Nga My tìm #RDß½ng TÑ Nß½ng #W#{_INFOAIM86,142,15, Dß½ng TÑ Nß½ng}, hãy nh¶ ông ta ðßa ngß½i t¾i các thành th¸ l¾n.",
								"Xin ngß½i hãy · núi Nga My %s tìm th¤y %s, hãy dùng %s ð¬ cho nó ån. #R #e00f000Nh¡c nhö: #e000000#r khi ngß½i t¾i g¥n Phøng Hoàng ðang c¥n cho ån, ¤n #gfff0f0Alt+A#g000000 có th¬ m· møc v§t ph¦m, ¤n vào#gfff0f0\" nhi®m vø\"#g000000giao di®n có th¬ m· ra møc v§t ph¦m nhi®m vø, nh¤p phím phäi#gfff0f0 Nga My Tiên Lµ#g000000, là có th¬ hoàn t¤t vi®c cho ån.",
								"Xin ngß½i hãy ði tìm th¤y %s, ông ta s¨ ðßa ngß½i ði thØ chiªn %s. #R #e00f000Nh¡c nhö: #e000000#r Chß·ng môn MÕnh Thanh Thanh · núi Nga My #{_INFOAIM96,73,15, MÕnh Thanh Thanh}. ",
								"Xin ngß½i hãy b¡t cho ta mµt con %p v«. #R #e00f000Nh¡c nhö: #e000000#r Vân Hàm Nhi · thành LÕc Dß½ng #{_INFOAIM183,155,0, Vân Hàm Nhi} có th¬ ðßa ngß½i t¾i Huy«n Vû Ðäo, nhßng Huy«n Vû Ðäo có 1 con ðß¶ng mòn thông qua Thánh Thú S½n. Ngß½i có th¬ b¡t trân thú mà ta c¥n · Huy«n Vû Ðäo ho£c · Thánh Thú S½n.",
								"Xin ngß½i hãy · núi Nga My tìm kiªm 4 phß½ng, tìm cho ta 5 %s. #R #e00f000Nh¡c nhö: #e000000#r Ngß½i có th¬ tìm th¤y nút vàng trong bän ð° nhö · góc phäi màn hình. #R Ngß½i có th¬ tìm th¤y #Yð° trang sÑc b¸ m¤t#W trên ngß¶i #Rcon khï ðen#W. #R Ngß½i có th¬ tìm th¤y #Yð° cúng tª b¸ m¤t#W trên ngß¶i #Rcon khï vàng#W. #R Ngß½i có th¬ tìm th¤y #Ychâu báu b¸ m¤t#W trên ngß¶i #Rcon khï tr¡ng#W.",
								"Hãy ðßa %s t¾i 1 cái %i, làm xong, ta s¨ h§u thß·ng cho ngß½i! #R #e00f000Nh¡c nhö: #e000000#r Ðào Hoa S½n · núi Nga My #{_INFOAIM156,99,15, Ðào Hoa S½n}. #R Ðào Di®p Tiên#W · núi Nga My #{_INFOAIM156,112,15, Ðào Di®p Tiên}. #R Ðào Chi S½n · núi Nga My #{_INFOAIM156,106,15,Ðào Chi S½n}. ",
								"Ði giªt chªt %s %s %n.",
								}

--¸ñÊ½×Ö·û´®ÖÐtoÕ ðµ Ë÷Òý, ±íÊ¾´Ó4¿ªÊ¼,ºó¶àÉÙÎ»ÊÓSetMissionByIndex(...)toÕ ðµ ¶àÉÙ¶ø¶¨
x229003_g_StrForePart=4

x229003_g_StrList = {
						"Nga my tiên lµ ",
						"Cây xuân c± thø và màn sß½ng",
						"BÕch Thüy Thu Phong ",
						"Tß Ngæ Ðài",
						"Trß¶ng Sinh Ði®n ",
						"MÕnh Thanh Thanh ",
						"Ðào Hoa Tr§n phø bän",
						"Trang sÑc b¸ m¤t ",
						"Tª ph¦m b¸ m¤t ",
						"Châu báu b¸ m¤t ",
						"Ðào hoa tiên",
						"Ðào Di®p Tiên",
						"Ðào Chi Tiên",
						"Sài Miêu Dã Sinh",
						"Kim Ðïnh Phøng Hoàng",
						"Linh Tuy«n Phøng Hoàng",
						"Ph§t Quang Phøng Hoàng",
						"VÕn Niên Phøng Hoàng",
						"0",
						"1",
						"2",
						"3",
						"4",
						"5",
						"6",
						"7",
						"8",
						"9",
						}
--MisDescEnd

--/////////////////////////////////////////////////////////////////////////////////////////////////////

--×ÓÈÎÎñtoÕ ðµ ÀàÐÍ´úºÅ¶¨Òå
x229003_g_SubMissionTypeEnum = {XunWu=1, SongXin=2, DingDianYinDao=3, FuBenZhanDou=4, BuZhuo=5, ShouJi=6, KaiGuang=7, otherMenpaiFuben=8, killMonster=9,}

--¶¨ ði¬mÒýµ¼
x229003_g_DingDianYinDaoList = {
											 {menpai=MP_EMEI     , itemId=40003030, itemName="Nga my tiên lµ ", scene=15, AreaName="Cây xuân c± thø và màn sß½ng", subAreaName="Kim Ðïnh Phøng Hoàng", posx1=39, posz1=32, posx2=57, posz2=46},
											 {menpai=MP_EMEI     , itemId=40003030, itemName="Nga my tiên lµ ", scene=15, AreaName="BÕch Thüy Thu Phong ", subAreaName="Linh Tuy«n Phøng Hoàng", posx1=134, posz1=33, posx2=157, posz2=54},
											 {menpai=MP_EMEI     , itemId=40003030, itemName="Nga my tiên lµ ", scene=15, AreaName="Tß Ngæ Ðài", subAreaName="Ph§t Quang Phøng Hoàng", posx1=32, posz1=139, posx2=46, posz2=160},
											 {menpai=MP_EMEI     , itemId=40003030, itemName="Nga my tiên lµ ", scene=15, AreaName="Trß¶ng Sinh Ði®n ", subAreaName="VÕn Niên Phøng Hoàng", posx1=132, posz1=148, posx2=160, posz2=160},
											}


--¸±±¾ÁÐ±í
x229003_g_FuBen_List = {
								{menpai=MP_EMEI     , NpcName="MÕnh Thanh Thanh", scene=15, posx=96, posz=73, FubenName="Ðào Hoa Tr§n phø bän"},
								}       

--ÊÕ¼¯
x229003_g_ShouJiList = {
								{menpai=MP_EMEI     , scene=15, itemId=40003031, itemName="Trang sÑc b¸ m¤t "},-- count=5},
								{menpai=MP_EMEI     , scene=15, itemId=40003032, itemName="Tª ph¦m b¸ m¤t "},-- count=5},								
								{menpai=MP_EMEI     , scene=15, itemId=40003033, itemName="Châu báu b¸ m¤t "},-- count=5},								
							}	



--ËÍÉú»î¼¼ÄÜnpcÁÐ±í
x229003_g_AbilityNpcList = {
                    {menpai=MP_EMEI     ,npcList={{name="Ðào hoa tiên", scene=15, x=156, z=99},
                                                  {name="Ðào Di®p Tiên", scene=15, x=156, z=112},
                                                  {name="Ðào Chi Tiên", scene=15, x=156, z=106}}
										},
									}

										
--²¶ÊÞÁÐ±í
x229003_g_PetList = {
						{petDataId=3000, petName="Sài Miêu Dã Sinh", takeLevel=10},
					}

x229003_g_Xin_ItemId = 40002119
x229003_g_ShimenPet_Index = 1

--É±¹ÖÏà¹Ø
x229003_g_MenpaiYiWuList = {
								{menpainame="Thiªu Lâm", menpai=MP_SHAOLIN  , itemName="Ðµ ði®p cüa Thiªu Lâm ð® tØ", scene=9,  itemId=40004306},
								{menpainame="Thiên Long", menpai=MP_DALI     , itemName="„n chß½ng cüa Thiên Long ð® tØ", scene=13, itemId=40004312},
								{menpainame="Nga My", menpai=MP_EMEI     , itemName="Kiªm tu® cüa Nga My ð® tØ", scene=15, itemId=40004310},
								{menpainame="Cái Bang", menpai=MP_GAIBANG  , itemName="Túi väi cüa Cái Bang ð® tØ", scene=10, itemId=40004307},
								{menpainame="Minh Giáo", menpai=MP_MINGJIAO , itemName="Höa l®nh cüa Minh Giáo ð® tØ", scene=11, itemId=40004308},
								{menpainame="Thiên S½n", menpai=MP_TIANSHAN , itemName="Bång bài cüa Thiên S½n ð® tØ", scene=17, itemId=40004314},
								{menpainame="Võ Ðang", menpai=MP_WUDANG   , itemName="Ph¤t tr¥n cüa Võ Ðang ð® tØ", scene=12, itemId=40004309},
								{menpainame="Tiêu Dao", menpai=MP_XIAOYAO  , itemName="Tiêu trì cüa Tiêu Dao ð® tØ", scene=14, itemId=40004313},
								{menpainame="Tinh Túc", menpai=MP_XINGSU   , itemName="C± mãnh cüa Tinh Túc ð® tØ", scene=16, itemId=40004311},
							}
	
--¹ÖÎïµôÂäÒÅÎïtoÕ ðµ ¼¸ÂÊÅäÖÃ±í
x229003_g_RateOfDropYiWuTable = {
							{playerLevel=20, dropRate=30},
							{playerLevel=30, dropRate=30},
							{playerLevel=40, dropRate=25},
							{playerLevel=50, dropRate=25},
							{playerLevel=60, dropRate=25},
							{playerLevel=70, dropRate=20},
							{playerLevel=80, dropRate=20},
							{playerLevel=90, dropRate=20},
							{playerLevel=100, dropRate=20},
							{playerLevel=110, dropRate=20},
							{playerLevel=120, dropRate=20},
							{playerLevel=130, dropRate=20},
							{playerLevel=140, dropRate=20},
							{playerLevel=150, dropRate=20},
						}
x229003_g_DemandKillcountTable = 	{
							{levelBegin=10, levelEnd=19, killcount=20},
							{levelBegin=20, levelEnd=39, killcount=25},
							{levelBegin=40, levelEnd=59, killcount=30},
							{levelBegin=60, levelEnd=79, killcount=35},
							{levelBegin=80, levelEnd=99, killcount=40},
							{levelBegin=100, levelEnd=109, killcount=45},
							{levelBegin=110, levelEnd=119, killcount=50},
							{levelBegin=120, levelEnd=150, killcount=55},
}						
 
--//////////////////////////////////////////////////////
--É±¹ÖÏà¹Ø
function x229003_GetMenpaiYiWuInfo(sceneId, selfId)
	for i, v in x229003_g_MenpaiYiWuList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			return v.menpainame, v.itemName, v.itemId
		end
	end
end

function x229003_GetRateOfDropYiWu(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229003_g_RateOfDropYiWuTable do
		if v.playerLevel >= playerLevel and playerLevel < v.playerLevel then
			return v.dropRate
		end
	end
end

function x229003_GetDemandKillCount(sceneId, selfId)
	local playerLevel = GetLevel(sceneId, selfId)
	for i, v in x229003_g_DemandKillcountTable do
		if playerLevel >= v.levelBegin and playerLevel <= v.levelEnd then
			return v.killcount
		end
	end
end

function x229003_KillMonster_Accept(sceneId, selfId)--É±¹Ö
	
	local nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level
	local playerLevel = GetLevel(sceneId, selfId)
	for i=1, 100 do
		nMonsterId, strMonsterName, strMonsterScene, nScene, nPosX, nPosZ, strDesc, nSex, level = GetOneMissionNpc(43)
		if abs(level - playerLevel) < 3 then
			break
		end
		if i == 100 then
			--Í³Í³ËÍÐÅÈ¥:((
			x229003_SongXin_Accept(sceneId, selfId)
			return
		end
	end	
	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 1, 0, 1 )
	if bAdd < 1 then
		return
	end	
	
	local killcount = x229003_GetDemandKillCount(sceneId, selfId)
	local countpart1 = x229003_GetStrIndexByStrValue(tostring(floor(killcount / 10)) )
	local countpart2 = x229003_GetStrIndexByStrValue(tostring(floor(mod(killcount, 10))) )

	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.killMonster)
	
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 0, killcount) --ÒªÇóÉ±ËÀtoÕ ðµ monster×ÜÊý, ÏÖTÕi »¹Ã»ÓÐ¸³Öµ
	SetMissionParamByIndexEx(sceneId, selfId, misIndex, 3, 1, 0) --Ðã giªt chªt toÕ ðµ monsterÊýÁ¿
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 8)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, countpart1)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, countpart2)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+3, nMonsterId)

		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, nScene, nPosX, nPosZ, strMonsterName)
	
	local strMissionTarget = format("G¥n ðây · khu vñc %s %s thß¶ng qu¤y nhi­u cß dân xung quanh, ngß½i hãy nh§n l®nh ði tr×ng phÕt chúng", 
						strMonsterScene, strMonsterName)
	AddText(sceneId, strMissionTarget)

end

--//////////////////////////////////////////////////////


function x229003_GetStrIndexByStrValue(stringV)
	for i, v in x229003_g_StrList do
		if v == stringV then
			return i-1
		end
	end
	local strText = format("C¥n phäi %s ðång kí StrList trong", stringV)
	--PrintStr(strText)
	return 0;
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--»ñÈ¡¾ßÌåitemtoÕ ðµ ÏêÏ¸ÐÅÏ¢
function x229003_GetItemDetailInfo(itemId)
	local itemId, itemName, itemDesc = GetItemInfoByItemId(itemId)
	if itemId == -1 then
		local strText = format("%s V§t ph¦m · 'MissionItem_HashTable.txt' không tìm th¤y!!", itemName)
		PrintStr(strText)
	end
	return itemId, itemName, itemDesc
end	
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--¸ù¾ÝÍæ¼ÒµÈc¤p ði¬mµ½¶ÔÓ¦MissionItem_HashTable.txtÖÐtoÕ ðµ µ¥ÔªË÷Òý
function x229003_GetMissionItemIndex(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0;
	elseif nPlayerLevel >= 20 and nPlayerLevel < 30 then
		return 1;
	elseif nPlayerLevel >= 30 and nPlayerLevel < 40 then
		return 2;
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 3;
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then
		return 4;
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then
		return 5;
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then
		return 167;
	elseif nPlayerLevel >= 100 then
		return 168;
	end
end

--¸ù¾ÝÍæ¼ÒµÈc¤p ði¬mµ½¶ÔÓ¦toÕ ðµ Nhi®m vø sß môntoÕ ðµ ½×¶Î
--¸ù¾ÝÍæ¼ÒµÈc¤p ði¬mµ½¶ÔÓ¦MissionNPC_HashTable.txtÖÐtoÕ ðµ µ¥ÔªË÷Òý
function x229003_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nPlayerLevel  = GetLevel(sceneId, selfId)
	if nPlayerLevel >= 10 and nPlayerLevel < 20 then
		return 0
	elseif nPlayerLevel >= 20 and nPlayerLevel < 40 then
		return 1
	elseif nPlayerLevel >= 40 and nPlayerLevel < 60 then
		return 2
	elseif nPlayerLevel >= 60 and nPlayerLevel < 80 then 
		return 3
	elseif nPlayerLevel >= 80 and nPlayerLevel < 100 then 
		return 4
	elseif nPlayerLevel >= 100 and nPlayerLevel < 120 then 
		return 243
	elseif nPlayerLevel >= 120 then
		return 244
	end
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_RandomSubMission(sceneId, selfId)


	--Ñ°Îï(1/4)¡¢ËÍÐÅ(1/16)¡¢ÊÕ¼¯(1/16)¡¢¿ª¹â(1/16)¡¢¶¨ ði¬mÒýµ¼(1/16)¡¢Cuµc chiªn ¸±±¾(1/4)¡¢²¶×½(1/4)
	local nRet = 1 + LuaFnGetHumanShimenRandom(sceneId, selfId);
	if nRet then
		if nRet <= 4 then
			x229003_XunWu_Accept(sceneId, selfId)
		elseif nRet <= 5 then
			x229003_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 6 then
			x229003_ShouJi_Accept(sceneId, selfId)
		elseif nRet <= 7 then
			x229003_SongXin_Accept(sceneId, selfId)
		elseif nRet <= 8 then
			x229003_DingDianYinDao_Accept(sceneId, selfId)
		elseif nRet <= 12 then
			x229003_FuBenZhanDou_Accept(sceneId, selfId)
		elseif nRet <= 16 then
			x229003_BuZhuo_Accept(sceneId, selfId)
		else
			return -1
		end
	else
		return -1;
	end
end
--**********************************
--¸ù¾ÝÍæ¼ÒµÈc¤p ði¬m³öÈÎÎñtoÕ ðµ µÈc¤p½×¶Î(1~5)
--**********************************
function x229003_DoSomethingByPlayerLevel(sceneId, selfId)
	CallScriptFunction(229000, "DoSomethingByPlayerLevel", sceneId, selfId, x229003_g_ScriptId)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_XunWu_Accept(sceneId, selfId)--Ñ°Îï
	----PrintStr("XunWu_Accept..")
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end
	
	local nitemId, strItemName, strItemDesc = GetOneMissionItem(x229003_GetMissionItemIndex(sceneId, selfId))
	Msg2Player(sceneId, selfId, "#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	--print(nitemId, strItemName, strItemDesc)
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.XunWu)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 1)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, nitemId)
	
	local strMissionTarget = format("%s cüa ta sao không th¤y ðâu? Nªu ngß½i có th¬ giúp ta tìm lÕi, ta s¨ không bÕc ðãi ngß½i", strItemName)
	AddText(sceneId, strMissionTarget)
	
	--¼ì²âÍæ¼ÒÉíÉÏtoÕ ðµ µÀ¾ßÐúng·ñÒÑ¾­Thöa mãnÍê³ÉÌõ¼þ
	local bHaveItem = HaveItem(sceneId, selfId, nitemId)
	if bHaveItem == 1 then
		SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--°ÑÈÎÎñÍê³É±êÖ¾ÖÃÎª1
		ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)
	end	
	
end	

--/////////////////////////////////////////////////////////////////////////////////////////////////////

function x229003_SongXin_Accept(sceneId, selfId)--ËÍÐÅ
	
  local roll = random(3)
	--Ëæ»úÑ¡³ö±¾ÃÅÅÉtoÕ ðµ ÌØ²ú±àºÅ,Ã¿cáiÃÅÅÉ3ÖÖÌØ²ú
	local shoujiItemId = x229003_g_ShouJiList[ roll ].itemId
				
	--ÈÎÎñ½±ÀøÏà¹Ø			
	BeginAddItem(sceneId)
		AddItem(sceneId, shoujiItemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	
	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end
	AddItemListToHuman(sceneId, selfId)
	--Ñ°Îï, ËÍÐÅÔòÉèÖ giâyø¶¨Ä¿±êNPCtoÕ ðµ ÊÂ¼þFlag
	SetMissionEvent(sceneId, selfId, x229003_g_MissionId, 4)


	local nPhase = x229003_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase)
	--print(nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc)
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, nPosX, nPosZ, strNpcName)
		
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.SongXin)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 0)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, nNpcId)

	local ListIndex = x229003_GetStrIndexByStrValue( x229003_g_ShouJiList[ roll ].itemName )
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, ListIndex )

  SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+3, shoujiItemId )
  
	local strMissionTarget = format("Lâu l¡m không g£p %s %s, ngß½i hãy giúp ta ðem %s giao cho ngß¶i ¤y", strNpcScene, strNpcName, x229003_g_ShouJiList[ roll ].itemName )
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_DingDianYinDao_Accept(sceneId, selfId)--¶¨ ði¬mÒýµ¼
	-- ðÕt ðßþcÍæ¼ÒtoÕ ðµ ÃÅÅÉ
	local playerMenpai = GetMenPai(sceneId, selfId)
	local a = {}
	local index = 1
	--ÓÃmµt cáiÁÙÊ±±íÀ´´æ´¢¶ÔÓ¦ÃÅÅÉTÕi x229003_g_DingDianYinDaoListÖÐtoÕ ðµ È«²¿Ë÷Òý
	for i, v in x229003_g_DingDianYinDaoList do
		if v.menpai == playerMenpai then
			a[index] = i
			index = index + 1
		end
	end
	
	local ct = getn(a)
	if ct <= 0 then
		return 0
	end
		
	local ret = random(ct)
	BeginAddItem(sceneId)
		AddItem(sceneId, x229003_g_DingDianYinDaoList[a[ret]].itemId, 1)
	local bAdd = EndAddItem(sceneId, selfId)
	if bAdd < 1 then
		return 
	end	
	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	AddItemListToHuman(sceneId, selfId)	
	Msg2Player(  sceneId, selfId,"#YNgß½i ðã ðÕt ðßþc 1 chiªc#W" .. x229003_g_DingDianYinDaoList[a[ret]].itemName, MSG2PLAYER_PARA )
	
	local strIndex_Area = x229003_GetStrIndexByStrValue(x229003_g_DingDianYinDaoList[a[ret]].AreaName)
	local strIndex_Item = x229003_GetStrIndexByStrValue(x229003_g_DingDianYinDaoList[a[ret]].itemName)
	local strIndex_subArea = x229003_GetStrIndexByStrValue(x229003_g_DingDianYinDaoList[a[ret]].subAreaName)
	
	local x1 = x229003_g_DingDianYinDaoList[a[ret]].posx1
	local x2 = x229003_g_DingDianYinDaoList[a[ret]].posx2
	local z1 = x229003_g_DingDianYinDaoList[a[ret]].posz1
	local z2 = x229003_g_DingDianYinDaoList[a[ret]].posz2
	local scene = x229003_g_DingDianYinDaoList[a[ret]].scene
	local tip = x229003_g_DingDianYinDaoList[a[ret]].AreaName .. x229003_g_DingDianYinDaoList[a[ret]].subAreaName
	local x = x1 + (x2-x1)/2
	local z = z1 + (z2-z1)/2
	
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.DingDianYinDao)
	SetMissionByIndex(sceneId, selfId, misIndex, 2, a[ret]) --ÉèÖÃ¶¨ ði¬mÒýµ¼ÁÐ±íÖÐtoÕ ðµ Ë÷Òý
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 3)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, strIndex_Area)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, strIndex_subArea)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+3, strIndex_Item)
	
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskThePos", sceneId, selfId, scene, x, z, tip)

	local strMissionTarget = format("Xin ngß½i hãy · núi Nga My %s tìm th¤y %s, hãy dùng %s ð¬ cho nó ån", 
		x229003_g_DingDianYinDaoList[a[ret]].AreaName, 
		x229003_g_DingDianYinDaoList[a[ret]].subAreaName, 
		x229003_g_DingDianYinDaoList[a[ret]].itemName)    
		
	AddText(sceneId, strMissionTarget)
	
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_FuBenZhanDou_Accept(sceneId, selfId)--Cuµc chiªn ¸±±¾
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	

	local npcName, fubenName, nSceneId, posx, posz
	for i, v in x229003_g_FuBen_List do
		if v.menpai == GetMenPai(sceneId, selfId) then
			npcName =  v.NpcName
			fubenName =  v.FubenName
			nSceneId = v.scene
			posx = v.posx
			posz = v.posz
			break
		end
	end

	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end	
	
	local nFormatIndex = GetMissionCacheData(sceneId, selfId, 0)
	local i = GetMissionCacheData(sceneId, selfId, 2)
	local NpcNameIndex = x229003_GetStrIndexByStrValue(npcName)
	local FubenNameIndex = x229003_GetStrIndexByStrValue(fubenName)
	
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
		
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.FuBenZhanDou)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 4)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, NpcNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, FubenNameIndex)
	
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, posx, posz, npcName)

	local strMissionTarget = format("Xin ngß½i hãy ði tìm %s, ngß¶i s¨ ðßa ngß½i ði thØ chiªn %s", npcName, fubenName)
	AddText(sceneId, strMissionTarget)
end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_BuZhuo_Accept(sceneId, selfId)--²¶×½
	local playerLevel = GetLevel(sceneId, selfId)
	local petId, petName, petDesc, takeLevel
	local petHashIndex = CallScriptFunction(229000, "GetMissionPetIndex", sceneId, selfId)
	for i = 1, 100 do
		petId, petName, petDesc = GetOneMissionPet(petHashIndex)
		takeLevel = GetPetTakeLevel(petId)
		if playerLevel > takeLevel  then
			break
		end
		if i == 100 then
			--Í³Í³ËÍÐÅÈ¥:((
			x229003_SongXin_Accept(sceneId, selfId)
		end

	end	
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end
	
	SetMissionEvent(sceneId, selfId, x229003_g_MissionId, 3)
	
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.BuZhuo)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 5)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, petId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngß½i hãy b¡t cho ta mµt con %s v«", petName)
	AddText(sceneId, strMissionTarget)
	
	--¼ì²âÍæ¼ÒÉíÉÏtoÕ ðµ µÀ¾ßÐúng·ñÒÑ¾­Thöa mãnÍê³ÉÌõ¼þ
	for i=0, 6 do
		local petDataId = LuaFnGetPet_DataID(sceneId,selfId,i)
		if petDataId == petId then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)					--°ÑÈÎÎñÍê³É±êÖ¾ÖÃÎª1

			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 3)
			break
		end	
	end	

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_ShouJi_Accept(sceneId, selfId)--ÊÕ¼¯
	--PrintStr("ShouJi_Accept...")
	local playerMenpai = GetMenPai(sceneId, selfId)
	if playerMenpai == MP_WUMENPAI then
		return 0
	end	
	--PrintStr("playerMenpai="..playerMenpai)
	local a = {}
	local index = 1
	for i, v in x229003_g_ShouJiList do
		if v.menpai == playerMenpai then
			--PrintStr("find...")
			a[index] = i
			index = index + 1
		end	
	end
	local ct = getn(a)
	--PrintStr("ct="..ct)
	if ct <= 0 then
		return 0
	end
	
	local ret = random(ct)
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 1 )
	if bAdd < 1 then
		return
	end	

	local itemNameIndex = x229003_GetStrIndexByStrValue(x229003_g_ShouJiList[a[ret]].itemName)
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.ShouJi)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 6)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, itemNameIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, x229003_g_ShouJiList[a[ret]].itemId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	
	local strMissionTarget = format("Xin ngß½i hãy giúp ta kiªm 5 %s v«", x229003_g_ShouJiList[a[ret]].itemName)
	AddText(sceneId, strMissionTarget)
end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
function x229003_Ability_Accept(sceneId, selfId)--¿ª¹â
	--PrintStr("Ability_Accept...")
	--local nPhase = x229003_GetShiMenPhaseByPlayerLevel(sceneId, selfId)
	--local nNpcId, strNpcName, strNpcScene, nSceneId, nPosX, nPosZ, strNPCDesc = GetOneMissionNpc(nPhase-1)
	local strNpcName, scene, x, z
	for i, v in x229003_g_AbilityNpcList do
		if v.menpai == GetMenPai(sceneId, selfId) then
			local ct = getn(v.npcList)
			local index =	random(ct)
			strNpcName = v.npcList[index].name
			scene = v.npcList[index].scene
			x = v.npcList[index].x
			z = v.npcList[index].z
		end
	end
	
	local strNpcIndex = x229003_GetStrIndexByStrValue(strNpcName)
	local itemId, itemName = GetMenpaiItem(sceneId, selfId)


	----PrintStr("itemId="..itemId.."  itemName="..itemName)
	--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
	local bAdd = AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
	if bAdd < 1 then
		return
	end
	
	SetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)		
	SetMissionEvent(sceneId, selfId, x229003_g_MissionId, 4)
	
	-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	
	SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
	SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.KaiGuang)
	
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 7)--formet×Ö·û´®Ë÷Òý
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, strNpcIndex)
	SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+2, itemId)
		
	Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
	CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, scene, x, z, strNpcName)
	
	local strMissionTarget = format("Hãy ðßa %scho%s, ta s¨ h§u ðãi ngß½i!", strNpcName, itemName)
	AddText(sceneId, strMissionTarget)

end
--/////////////////////////////////////////////////////////////////////////////////////////////////////
--**********************************
--ÈÎÎñÈë¿Úº¯Êý
--**********************************
function x229003_OnDefaultEvent( sceneId, selfId, targetId )	-- ði¬m»÷¸ÃÈÎÎñºóÖ´ÐÐ´Ë½Å±¾
	----PrintStr("OnDefaultEvent...")
	--·¢ËÍÈÎÎñÐèÇótoÕ ðµ ÐÅÏ¢
	if IsHaveMission(sceneId,selfId,x229003_g_MissionId) > 0 then
		if GetName(sceneId, targetId) == x229003_g_Name then
			--·¢ËÍÈÎÎñÐèÇótoÕ ðµ ÐÅÏ¢
			BeginEvent(sceneId)
				AddText(sceneId, x229003_g_MissionName)
				AddText(sceneId, "Vi®c ta giao ðã hoàn thành chßa?")
			EndEvent( )
			bDone = x229003_CheckSubmit( sceneId, selfId )
			DispatchMissionDemandInfo(sceneId, selfId, targetId, x229003_g_ScriptId, x229003_g_MissionId, bDone)
		else
			local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
			
			local demandItemId =0
			local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
			if missionType == x229003_g_SubMissionTypeEnum.SongXin then
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+3)
			else
			    demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
			end	
			
			local _, strDemandItemName, _ = x229003_GetItemDetailInfo(demandItemId)
			
			local bHaveItem = HaveItem(sceneId, selfId, demandItemId)
			if bHaveItem == 1 then
				if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
				DelItem(sceneId, selfId, demandItemId, 1)
				BeginEvent(sceneId)
					AddText(sceneId, "Xin các hÕ quay v« nói v¾i Sß phø cüa các hÕ, tÕi hÕ r¤t nh¾ sß phø cüa các hÕ, r¤t cäm ½n sß phø cüa các hÕ t£ng món quà này cho tÕi hÕ, ðây là thÑ mà tÕi hÕ ðang mu¯n có ðßþc.")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				--ÉèÖÃÈÎÎñÒÑ¾­Íê³É
				SetMissionByIndex(sceneId, selfId, misIndex, 0, 1)
				ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 4)
				return 1;
			else
				BeginEvent(sceneId)
						AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
					EndEvent( )
					DispatchMissionTips(sceneId,selfId)	
					return	
				end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "Ðã mang t¾i thÑ ta c¥n chßa?")
				EndEvent()
				DispatchEventList(sceneId, selfId, targetId)	
				return 1;					
			end
		end
	elseif x229003_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229003_g_MissionName)
			AddText(sceneId,x229003_g_MissionInfo)
			AddText(sceneId,"#{M_MUBIAO}#r")
			
			x229003_DoSomethingByPlayerLevel(sceneId, selfId)
			--±£Ö¤µÚmµt ´Î½Óµ½toÕ ðµ ÈÎÎñ×ÜÐúng¹Ì¶¨²»±ätoÕ ðµ 
			--ResetMissionCacheData(sceneId, selfId)
			--SetMissionCacheData(sceneId, selfId, 0, 0) --formet×Ö·û´®Ë÷Òý
			--SetMissionCacheData(sceneId, selfId, 1, x229003_g_SubMissionTypeEnum.SongXin)
			--SetMissionCacheData(sceneId, selfId, 2, 100001) --ÉèÖÃhumanÉíÉÏµÚ0Î»»º´æÊý¾Ý
			--SetMissionCacheData(sceneId, selfId, 7, 1) --Ðúng·ñÐúngµÚmµt ´Î
			
			--strMissionTarget = format("ºÃ¾ÃÃ»ÓÐ¼û%sÁË,Çë´úÎÒÎÊºòmµt ÏÂËûÈ¥", "frankwu")
			--AddText(sceneId, strMissionTarget)

			--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁÐ±í
			--AddMission( sceneId,selfId, x229003_g_MissionId, x229003_g_ScriptId, 0, 0, 0 )
			--Ñ°Îï, ËÍÐÅÔòÉèÖ giâyø¶¨Ä¿±êNPCtoÕ ðµ ÊÂ¼þFlag
			--SetMissionEvent(sceneId, selfId, x229003_g_MissionId, 4)

			--local _, strNpcName, strNpcScene, PosX, PosZ, _ = GetNpcInfoByNpcId(sceneId,100001)
			--Msg2Player(  sceneId, selfId,"#YNh§n nhi®m vø#W: Nhi®m vø sß môn", MSG2PLAYER_PARA )
			--CallScriptFunction( SCENE_SCRIPT_ID, "AskTheWay", sceneId, selfId, nSceneId, PosX, PosZ, strNpcName)
				
			-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
			--local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, 0, 0) --ÉèÖÃÈÎÎñÐúng·ñÍê³É(Î´Íê³É)
			--SetMissionByIndex(sceneId, selfId, misIndex, 1, x229003_g_SubMissionTypeEnum.SongXin)
			
			--SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart, 0)--formet×Ö·û´®Ë÷Òý
			--SetMissionByIndex(sceneId, selfId, misIndex, x229003_g_StrForePart+1, 100001)
		
			
		EndEvent( )
		DispatchEventList(sceneId,selfId,targetId)
	end
	
end

--**********************************
--ÁÐ¾ÙÊÂ¼þ
--**********************************
function x229003_OnEnumerate( sceneId, selfId, targetId )
	----PrintStr("807002...OnEnumerate")
--Èç¹ûÍæ¼ÒÍê³É¹ýCái này ÈÎÎñ
	if IsMissionHaveDone(sceneId,selfId,x229003_g_MissionId) > 0 then
  	return
--Thöa mãnÈÎÎñ½ÓÊÕÌõ¼þ
	elseif IsHaveMission(sceneId,selfId,x229003_g_MissionId) > 0 then
		local strNpcName = x229003_g_Name -- temp code
		if GetName(sceneId,targetId) == strNpcName then
			AddNumText(sceneId, x229003_g_ScriptId,x229003_g_MissionName,4,-1);
		end
--Thöa mãnÈÎÎñ½ÓÊÕÌõ¼þ
  elseif x229003_CheckAccept(sceneId,selfId) > 0 then
		if GetName(sceneId,targetId) == x229003_g_Name then
			AddNumText(sceneId,x229003_g_ScriptId,x229003_g_MissionName,3,-1);
		end
  end
end
--**********************************
--Tiªp thø
--**********************************
function x229003_OnAccept( sceneId, selfId )
	--PrintStr("OnAccept...")
	--local nMissionType = GetMissionCacheData(sceneId, selfId, 1)
	--if nMissionType == x229003_g_SubMissionTypeEnum.XunWu then
	--	x229003_XunWu_Accept(sceneId, selfId)
	--elseif nMissionType == x229003_g_SubMissionTypeEnum.SongXin then
	--	x229003_SongXin_Accept(sceneId, selfId)
	--elseif nMissionType == x229003_g_SubMissionTypeEnum.DingDianYinDao then
	--	x229003_DingDianYinDao_Accept(sceneId, selfId)
	--elseif nMissionType == x229003_g_SubMissionTypeEnum.FuBenZhanDou then
	--	x229003_FuBenZhanDou_Accept(sceneId, selfId)
	--elseif nMissionType == x229003_g_SubMissionTypeEnum.BuZhuo then
	--	x229003_BuZhuo_Accept(sceneId, selfId)
	--end
end

--**********************************
--¼ì²âTiªp thøÌõ¼þ
--**********************************
function x229003_CheckAccept( sceneId, selfId )
	local nLevel = GetLevel(sceneId, selfId)
	--Íæ¼ÒµÈc¤p>=10c¤p
	if nLevel < 10 then
		return 0
	else
		local playerMenpai = GetMenPai(sceneId, selfId)
		if playerMenpai ~= MP_EMEI then
			return 0
		end	
	end
	return 1;
end

--**********************************
--·ÅÆú
--**********************************
function x229003_OnAbandon( sceneId, selfId )
	----PrintStr("OnAbandon...")
	if IsHaveMission(sceneId, selfId, x229003_g_MissionId) > 0 then	
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)		-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		if missionType == x229003_g_SubMissionTypeEnum.SongXin then
			local missionItem = GetMissionParam(sceneId, selfId, misIndex,x229003_g_StrForePart+3)
			if HaveItem(sceneId, selfId, missionItem) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, missionItem) >= 1 then
			DelItem(sceneId, selfId, missionItem, 1)		
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end	
			end	
		elseif missionType == x229003_g_SubMissionTypeEnum.DingDianYinDao	then
			local index = GetMissionParam(sceneId, selfId, misIndex,2)
			if HaveItem(sceneId, selfId, x229003_g_DingDianYinDaoList[index].itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, x229003_g_DingDianYinDaoList[index].itemId) >= 1 then
			DelItem(sceneId, selfId,x229003_g_DingDianYinDaoList[index].itemId,1)
			else	
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
			end	
		elseif missionType == x229003_g_SubMissionTypeEnum.ShouJi then
			local itemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
			if HaveItem(sceneId, selfId, itemId) == 1 then
			if LuaFnGetAvailableItemCount(sceneId, selfId, itemId) >= 5 then
			DelItem(sceneId, selfId,itemId,5)
			else	
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
		end
		end
		--É¾³ýÍæ¼ÒÈÎÎñÁÐ±íÖÐ¶ÔÓ¦toÕ ðµ ÈÎÎñ
	  DelMission( sceneId, selfId, x229003_g_MissionId )
	  SetMissionData(sceneId,selfId,MD_SHIMEN_HUAN,0)	--»·ÊýÇå0
	end	
 	--µ÷ÓÃÍ¨ÓÃ·ÅÆú½Ó¿Ú
	------------------------------------------------------------------
	 CallScriptFunction( 500501, "Abandon_Necessary", sceneId, selfId )
	-------------------------------------------------------------------
end

--**********************************
--¼ÌÐø
--**********************************
function x229003_OnContinue( sceneId, selfId, targetId )
	----PrintStr("OnContinue...")
	if x229003_CheckAccept(sceneId,selfId) > 0 then
		BeginEvent(sceneId)
		
			AddText(sceneId,x229003_g_MissionName)
			AddText(sceneId,x229003_g_MissionComplete)
			
		  --x229003_DoSomethingByPlayerLevel(sceneId, selfId)
		  
		EndEvent( )
		DispatchMissionContinueInfo(sceneId, selfId, targetId, x229003_g_ScriptId, x229003_g_MissionId)
	end	
end

--**********************************
--¼ì²âÐúng·ñ¿ÉÒÔÌá½»
--**********************************
function x229003_CheckSubmit( sceneId, selfId )
	if IsHaveMission( sceneId, selfId, x229003_g_MissionId ) <= 0 then
		return 0
	end

	--TÕi ´ËÅÐ¶ÏÌá½»Ìõ¼þÐúng·ñ·ûºÏ,²¢¸øÓèÏàÓ¦½±Àø
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	
	if missionType == x229003_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
		if GetItemCount(sceneId,selfId,demandItemId) <= 0 then --Ã»ÓÐË÷ÒªtoÕ ðµ ÎïÆ·
			return 0
		end
		if IsEquipItem(demandItemId) == 1 and IsWhiteEquip(demandItemId) ~= 1 then
			return 2
		else
			return 1
		end		
	elseif missionType == x229003_g_SubMissionTypeEnum.ShouJi then
	 	local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
	 	if GetItemCount(sceneId,selfId,demandItemId) < 5 then --Ã»ÓÐË÷ÒªtoÕ ðµ ÎïÆ·
	 		return 0
	 	else
	 		return 1	
	 	end
	elseif missionType == x229003_g_SubMissionTypeEnum.BuZhuo then
		return 2
	elseif GetMissionParam(sceneId, selfId, misIndex, 0) > 0 then	--²ì¿´ÈÎÎñÐúng·ñÍê³É
		return 1
	end

	return 0
end

function x229003_OnLockedTarget(sceneId, selfId, objId )
	----PrintStr("OnLockedTarget...")
	if GetName(sceneId, objId) == x229003_g_Name  then
		return 0
	end
	-- ÅÐ¶ÏÐúng²»ÐúngËø¶¨toÕ ðµ Npc
	if IsHaveMission(sceneId, selfId, x229003_g_MissionId) > 0 then
		local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)		-- ði¬mµ½ÈÎÎñTÕi 20cáiÈÎÎñÖÐtoÕ ðµ ÐòÁÐºÅ
		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		
		local nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc
		if missionType == x229003_g_SubMissionTypeEnum.KaiGuang then
			nNpcIndex = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
			strNpcName = x229003_g_StrList[nNpcIndex+1]
		else
			nNpcId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
			nNpcId, strNpcName, strNpcScene, PosX, PosZ, desc = GetNpcInfoByNpcId(sceneId,nNpcId)
		end
			 
		if GetName(sceneId, objId) == strNpcName then
			TAddNumText(sceneId,x229003_g_ScriptId,x229003_g_MissionName,4,-1,x229003_g_ScriptId);
		end

	end
	
	return 0;

end

function x229003_CheckCondition_UseItem( sceneId, selfId, targetId, eventId )
	------PrintStr("OnUseItem...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	-- ðÕt ðßþc¸ÃÈÎÎñtoÕ ðµ ÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229003_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	local targetSceneId = x229003_g_DingDianYinDaoList[index].scene
	--PrintNum(sceneId)
	if sceneId ~= targetSceneId then
		BeginEvent(sceneId)

			AddText(sceneId,"Hình nhß · ðây không ðßþc b¡n")

		EndEvent(sceneId)

		DispatchMissionTips(sceneId,selfId)

		return 0
	end
	
	local posx1 = x229003_g_DingDianYinDaoList[index].posx1
	local posz1 = x229003_g_DingDianYinDaoList[index].posz1
	local posx2 = x229003_g_DingDianYinDaoList[index].posx2
	local posz2 = x229003_g_DingDianYinDaoList[index].posz2

	--È¡ ði¬mÍæ¼Òµ±Ç°×ø±ê

	local PlayerX = GetHumanWorldX(sceneId,selfId)

	local PlayerZ = GetHumanWorldZ(sceneId,selfId)

	
	--¼ÆËãÍæ¼ÒÓëÄ¿±ê ði¬mtoÕ ðµ ¾àÀë
	if PlayerX >= posx1 and PlayerX < posx2 then
		------PrintStr("PlayerX >= posx1 and PlayerX < posx2...")
		if PlayerZ >= posz1 and PlayerZ < posz2 then
			------PrintStr("PlayerZ >= posz1 and PlayerZ < posz2...")
			return 1
		end
	end	

	BeginEvent(sceneId)

		AddText(sceneId, "Chï ðßþc sØ døng trong khu vñc chï ð¸nh!")

	EndEvent(sceneId)

	DispatchMissionTips(sceneId,selfId)
	return 0

end

--**********************************
--µÀ¾ßÊ¹ÓÃ
--**********************************
function x229003_Active_UseItem( sceneId, selfId, param0 )
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	-- ðÕt ðßþc¸ÃÈÎÎñtoÕ ðµ ÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType ~= x229003_g_SubMissionTypeEnum.DingDianYinDao then
		return 0
	end
	
	local index = GetMissionParam(sceneId, selfId, misIndex, 2)
	if LuaFnGetAvailableItemCount(sceneId, selfId, x229003_g_DingDianYinDaoList[index].itemId) >= 1 then
		DelItem( sceneId, selfId, x229003_g_DingDianYinDaoList[index].itemId, 1 )
	--°ÑÈÎÎñ×´Ì¬±äÁ¿ÉèÖÃÎª1,±íÊ¾ÒÑ¾­Íê³É
	SetMissionByIndex(sceneId,selfId,misIndex,0,1)
	else
			BeginEvent(sceneId)
				AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
			EndEvent( )
			DispatchMissionTips(sceneId,selfId)	
			return	
	end	
end

--**********************************
--µÀ¾ß¸Ä±ä
--**********************************
function x229003_OnItemChanged( sceneId, selfId, itemdataId )
	----PrintStr("OnItemChanged")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	-- ðÕt ðßþc¸ÃÈÎÎñtoÕ ðµ ÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229003_g_SubMissionTypeEnum.XunWu then
		local _, strItemName, _ = x229003_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
		local _, strDemandItemName, _ = x229003_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)

				
				strText = format("Ðã ðÕt ðßþc %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)
		end
	elseif missionType == x229003_g_SubMissionTypeEnum.KaiGuang then
		local _, strItemName, _ = x229003_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
		local _, strDemandItemName, _ = x229003_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				strText = format("Ðã ðÕt ðßþc %s", strItemName)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)
		end
	elseif missionType == x229003_g_SubMissionTypeEnum.ShouJi then
		local itemCount = GetItemCount(sceneId,selfId,itemdataId)
		local _, strItemName, _ = x229003_GetItemDetailInfo(itemdataId)
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
		local _, strDemandItemName, _ = x229003_GetItemDetailInfo(demandItemId)
		
		if strItemName == strDemandItemName then
			BeginEvent(sceneId)
				local _, strItemName, _ = x229003_GetItemDetailInfo(itemdataId)
				strText = format("Ðã ðÕt ðßþc %s%d/5", strItemName, itemCount)
				AddText(sceneId,strText)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)
						
			if itemCount == 5 then
				SetMissionByIndex(sceneId,selfId,misIndex,0,1)
				ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)
			end
		end
	elseif missionType == x229003_g_SubMissionTypeEnum.killMonster then
		local _, _, itemId = x229003_GetMenpaiYiWuInfo(sceneId, selfId)
		if itemdataId == itemId  then
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 0)
			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 2)
		end
	end

end

--**********************************
--ÕäÊÞ¸Ä±ä
--**********************************
function x229003_OnPetChanged( sceneId, selfId, petDataId)
	----PrintStr("OnPetChanged...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	-- ðÕt ðßþc¸ÃÈÎÎñtoÕ ðµ ÈÎÎñÀàÐÍ
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229003_g_SubMissionTypeEnum.BuZhuo then
		local demandPetDataId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
		
		if petDataId == demandPetDataId then
			BeginEvent(sceneId)
				local strText = format("Ðã ðÕt ðßþc %s", GetPetName(petDataId))
				AddText(sceneId,strText)
			EndEvent(sceneId)

			DispatchMissionTips(sceneId,selfId)
			SetMissionByIndex(sceneId,selfId,misIndex,0,1)
			ResetMissionEvent(sceneId, selfId, x229003_g_MissionId, 3)
		end
	end
end
--**********************************
--Ìá½»
--**********************************
function x229003_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	----PrintStr("OnSubmit...")
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	if x229003_CheckSubmit( sceneId, selfId, selectRadioId )>=1 then

		local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
		if missionType == x229003_g_SubMissionTypeEnum.XunWu then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
			--PrintStr("demandItemId"..demandItemId)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 1 then
			local ret = DelItem(sceneId, selfId, demandItemId, 1)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "Không ðü v§t ph¦m c¥n, nhi®m vø không th¬ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
--		elseif missionType == x229003_g_SubMissionTypeEnum.killMonster then
--			local _, _, demandItemId  = x229003_GetMenpaiYiWuInfo(sceneId, selfId)
--			local ret = DelItem(sceneId, selfId, demandItemId, 1)
--			if ret <= 0 then
--				BeginEvent(sceneId)
--					AddText(sceneId, "Không ðü v§t ph¦m c¥n, nhi®m vø không th¬ giao")
--				EndEvent()
--				DispatchMissionTips(sceneId, selfId)
--				return
--			end
		elseif missionType == x229003_g_SubMissionTypeEnum.ShouJi then
			local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
			if LuaFnGetAvailableItemCount(sceneId, selfId, demandItemId) >= 5 then
			local ret = DelItem(sceneId, selfId, demandItemId, 5)
			if ret <= 0 then
				BeginEvent(sceneId)
					AddText(sceneId, "Không ðü v§t ph¦m c¥n, nhi®m vø không th¬ giao")
				EndEvent()
				DispatchMissionTips(sceneId, selfId)
				return
			end
			else
				BeginEvent(sceneId)
					AddText(sceneId, "V§t ph¦m cüa các hÕ hi®n không dùng ðßþc ho£c ðã b¸ khóa")
				EndEvent( )
				DispatchMissionTips(sceneId,selfId)	
				return	
			end
		end

		DelMission( sceneId, selfId, x229003_g_MissionId )
		--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

		------------------------------------------------------------------
		local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId )
		if Reward_Append == 2 and MissionRound == 20 then
			CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229003_g_MissionId, targetId)
		end
		-------------------------------------------------------------------

		--x229003_OnDefaultEvent( sceneId, selfId, targetId )
		
	end
end

function x229003_OnMissionCheck( sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex )
  if x229003_CheckSubmit( sceneId, selfId) < 1 then
    return 0
  end

	--PrintStr("OnMissionCheck...")
	print(sceneId, selfId, npcid, scriptId, index1, index2, index3, petindex)
	local misIndex = GetMissionIndexByID(sceneId, selfId, x229003_g_MissionId)

	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)
	if missionType == x229003_g_SubMissionTypeEnum.XunWu then
		local demandItemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
		local _, strDemandItemName, _ = x229003_GetItemDetailInfo(demandItemId)
		--PrintStr("strDemandItemName="..strDemandItemName)
		--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

		------------------------------------------------------------------

		local find = CallScriptFunction( 500501, "OnMissionCheck_NecessaryEx", sceneId, selfId, index1, index2, index3, demandItemId )

		-------------------------------------------------------------------


		if find < 0 then

			BeginEvent(sceneId)

				local strText = format("Sao ngß½i vçn chßa ðem %s v« ðßþc mà ðã quay v«?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

			return
		end
		
		local ret = EraseItem( sceneId, selfId, find )
		if	ret > 0 then

			DelMission( sceneId, selfId, x229003_g_MissionId )

			--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

			------------------------------------------------------------------
			local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
			if Reward_Append == 2 and MissionRound == 20 then
				CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229003_g_MissionId)
			end
			-------------------------------------------------------------------

		else
			BeginEvent(sceneId)

				local strText = format("Sao ngß½i vçn chßa ðem %s v« ðßþc mà ðã quay v«?", strDemandItemName)
				AddText(sceneId,strText)
				AddItemBonus( sceneId, demandItemId, 1 )
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)
		end	
	elseif missionType == x229003_g_SubMissionTypeEnum.BuZhuo then
		----PrintStr("OnMissionCheck...BuZhuo...")
		local demandPetId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+1)
		local petId = LuaFnGetPet_DataID(sceneId, selfId, petindex)
		if petId == demandPetId then
			if LuaFnIsPetAvailable(sceneId, selfId, petindex) >= 1 then
				LuaFnDeletePet(sceneId, selfId, petindex)
				----PrintStr("DeletePet"..petId..demandPetId)
				DelMission( sceneId, selfId, x229003_g_MissionId )

				--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú

				------------------------------------------------------------------
				local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, -1 )
				if Reward_Append == 2 and MissionRound == 20 then
					CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229003_g_MissionId)
				end
				-------------------------------------------------------------------
			end	
		else
			BeginEvent(sceneId)
				AddText(sceneId, "Sao ngß½i vçn chßa ðem trân thú mà ta c¥n v« ðßþc mà ðã quay v«?")
			EndEvent(sceneId)

			DispatchEventList(sceneId,selfId,-1)

		end

	end -- endif
	
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x229003_OnKillObject( sceneId, selfId, objdataId ,objId)--²ÎÊýÒâË¼: ³¡¾°ºÅ¡¢Íæ¼ÒobjId¡¢¹ÖÎï±íÎ»ÖÃºÅ¡¢¹ÖÎï
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	local nMonsterId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+3)
	local _, strMonsterName = GetNpcInfoByNpcId(sceneId,nMonsterId)
	local monsterName = GetMonsterNamebyDataId(objdataId)
	
	if strMonsterName == monsterName  then
		local num = GetMonsterOwnerCount(sceneId,objId)
		for i=0,num-1  do
			-- È¡ ði¬mÓµÓÐ·ÖÅäÈ¨toÕ ðµ ÈËtoÕ ðµ objId
			local humanObjId = GetMonsterOwnerID(sceneId,objId,i)
			--PrintStr("humanObjId=" .. humanObjId)
			-- ¿´Cái này ÈËÐúng²»ÐúngÓÐCái này ÈÎÎñ
			if IsHaveMission(sceneId, humanObjId, x229003_g_MissionId) > 0 then
				-- ÏÈÅÐ¶ÏÐúng²»ÐúngÒÑ¾­Thöa mãnÁËÍê³É±êÖ¾
				local misIndex = GetMissionIndexByID(sceneId,humanObjId,x229003_g_MissionId)
				if GetMissionParam(sceneId, humanObjId, misIndex, 0) <=0  then
					--SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 0, 30)
					local demandKillCount = GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 0)
					--PrintStr("demandKillCount=" .. demandKillCount)
					local killedCount =	GetMissionParamEx(sceneId, humanObjId, misIndex, 3, 1)
					killedCount = killedCount + 1
					SetMissionParamByIndexEx(sceneId, humanObjId, misIndex, 3, 1, killedCount)
					--PrintStr("killedCount=" .. killedCount)
					BeginEvent(sceneId)
						local str = format("Ðã giªt chªt %d/%d%s", killedCount, demandKillCount, monsterName)
						AddText(sceneId, str)
					EndEvent()
					DispatchMissionTips(sceneId, humanObjId)
					if killedCount == demandKillCount then
						SetMissionByIndex(sceneId, humanObjId, misIndex, 0, 1)
		end
				end --if
			end --if
		end --for				
	end

end


--**********************************
--Í¬ÃÅÏàÖú....Ö±½ÓÍê³Éµ±Ç°»·....
--**********************************
function x229003_HelpFinishOneHuan( sceneId, selfId, targetId )

	--Ðúng·ñÐúng±¾ÃÅÅÉµÜ×Ó....
	if MP_EMEI ~= GetMenPai( sceneId, selfId ) then
		return
	end

	--Ðúng·ñ½ÓÁËNhi®m vø sß môn....
	if IsHaveMission(sceneId,selfId,x229003_g_MissionId) <= 0 then
		return
	end

	--¼ì²â²¢¿Û³ýÍ¬ÃÅÏàÖúËùÐètoÕ ðµ Ê¦ÃÅ¹±Ï×....
	local ret = CallScriptFunction( 229011, "CheckAndDepleteHelpFinishMenPaiPoint", sceneId, selfId, targetId )
	if ret == 0 then
		return
	end

	--»ñÈ¡Nhi®m vø sß môntoÕ ðµ ÀàÐÍ....
	local misIndex = GetMissionIndexByID(sceneId,selfId,x229003_g_MissionId)
	local missionType = GetMissionParam(sceneId, selfId, misIndex, 1)

	--Çå³ýÈÎÎñÎïÆ·....
	local itemId = -1
	local itemCount = -1

	if missionType == x229003_g_SubMissionTypeEnum.SongXin then
		itemId = GetMissionParam(sceneId, selfId, misIndex,x229003_g_StrForePart+3)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)
		end
	elseif missionType == x229003_g_SubMissionTypeEnum.DingDianYinDao	then
		local index = GetMissionParam(sceneId, selfId, misIndex,2)
		itemId = x229003_g_DingDianYinDaoList[index].itemId
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount >= 1 then
			DelItem(sceneId, selfId, itemId, 1)	
		end
	elseif missionType == x229003_g_SubMissionTypeEnum.ShouJi then
		itemId = GetMissionParam(sceneId, selfId, misIndex, x229003_g_StrForePart+2)
		itemCount = LuaFnGetAvailableItemCount(sceneId, selfId, itemId)
		if itemCount > 5 then
			itemCount = 5
		end
		if itemCount > 0 then
			DelItem(sceneId, selfId, itemId, itemCount)
		end
	end

	--É¾³ýÍæ¼ÒÈÎÎñÁÐ±íÖÐ¶ÔÓ¦toÕ ðµ ÈÎÎñ....
	DelMission( sceneId, selfId, x229003_g_MissionId )

	--µ÷ÓÃÍ¨ÓÃÌá½»ÈÎÎñ½Ó¿Ú½Ó¿Ú....
	local Reward_Append, MissionRound = CallScriptFunction( 500501, "OnSubmit_Necessary", sceneId, selfId, targetId, 1 )

	if Reward_Append == 2 and MissionRound == 20 then
		--½±ÀøÍæ¼Òmµt cáiÈ¥±ðtoÕ ðµ ÃÅÅÉ¸±±¾toÕ ðµ Nhi®m vø sß môn....
		CallScriptFunction(229010, "AddOtherMenpaiFubenMission", sceneId, selfId, x229003_g_MissionId, targetId)
	end

end
